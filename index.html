<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.1.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.1.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.1.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.1.0">


  <link rel="mask-icon" href="/images/logo.svg?v=7.1.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '7.1.0',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"bounceUpIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta property="og:type" content="website">
<meta property="og:title" content="Hey">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Hey">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hey">





  
  
  <link rel="canonical" href="http://yoursite.com/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Hey</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

<script>
  !(function(c,b,d,a){c[a]||(c[a]={});c[a].config={pid:"edoafng5gp@95fdd72b343c07d",appType:"web",imgUrl:"https://arms-retcode.aliyuncs.com/r.png?",enableSPA:true,useFmp:true,sendResource:true};
  with(b)with(body)with(insertBefore(createElement("script"),firstChild))setAttribute("crossorigin","",src=d)
  })(window,document,"https://retcode.alicdn.com/retcode/bl.js","__bl");
</script>

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Hey</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <h1 class="site-subtitle" itemprop="description">If not now, when? If not me, who?</h1>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home menu-item-active">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>Tags</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>Categories</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/06/http-response-header/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr.J">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/logo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hey">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/2020/06/06/http-response-header/" class="post-title-link" itemprop="url">安全相关的HTTP响应头</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-06-06 17:30:00 / Modified: 09:36:31" itemprop="dateCreated datePublished" datetime="2020-06-06T17:30:00+00:00">2020-06-06</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/TCP-IP/" itemprop="url" rel="index"><span itemprop="name">TCP/IP</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2020/06/06/http-response-header/" class="leancloud_visitors" data-flag-title="安全相关的HTTP响应头">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">Views: </span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="安全相关的HTTP响应头"><a href="#安全相关的HTTP响应头" class="headerlink" title="安全相关的HTTP响应头"></a>安全相关的HTTP响应头</h2><h3 id="Strict-Transport-Security"><a href="#Strict-Transport-Security" class="headerlink" title="Strict-Transport-Security"></a>Strict-Transport-Security</h3><p>简称HSTS，要求浏览器总是通过HTTPS访问该网站。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Strict-Transport-Security <span class="string">"max-age=63072000; includeSubdomains;"</span>;</span><br><span class="line"><span class="comment">// includeSubDomains 可选，用来指定是否作用于子域名。</span></span><br></pre></td></tr></table></figure>
<h3 id="X-Frame-Options"><a href="#X-Frame-Options" class="headerlink" title="X-Frame-Options"></a>X-Frame-Options</h3><p>不允许以 iframe 或 frame 的形式嵌入，是为了减少点击劫持而引入的一个响应头。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X-Frame-Options DENT;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>DENT：不允许被任何页面嵌套</li>
<li>SAMEORIGIN：不允许被本域以外的页面嵌入</li>
<li>ALLOW-FROM uri：不允许被指定的域名以外的页面嵌入</li>
</ul>
<h3 id="X-XSS-Protection"><a href="#X-XSS-Protection" class="headerlink" title="X-XSS-Protection"></a>X-XSS-Protection</h3><p>用来防范XSS，目前主流浏览器都默认开启XSS保护。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X-Xss-Protection <span class="string">"1; mode=block"</span>;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>0：禁用XSS保护</li>
<li>1：启用XSS保护</li>
<li>1; mode=block：启用XSS保护，并在检测到XSS攻击时停止渲染页面</li>
</ul>
<h3 id="X-Content-Type-Options"><a href="#X-Content-Type-Options" class="headerlink" title="X-Content-Type-Options"></a>X-Content-Type-Options</h3><p>浏览器一般会根据Content-Type响应头来判断请求的资源类型，例如：”text/html” 代表html文档，”image/png” 代表png图片， “text/css” 代表CSS样式。<br>如果有些资源的COntent-Type是错误的或未定义的，部分浏览器会启用MIME-sniffing来猜测该资源的类型，并解析执行。<br>该响应头可以禁用浏览器的Content-Type猜测行为。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X-Content-Type-Options nosniff;</span><br></pre></td></tr></table></figure></p>
<h3 id="X-Content-Security-Policy"><a href="#X-Content-Security-Policy" class="headerlink" title="X-Content-Security-Policy"></a>X-Content-Security-Policy</h3><p>定义页面可以加载哪些资源，减少XSS的发生。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Content-Security-Policy: <span class="keyword">default</span>-src <span class="string">'self'</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><a href="https://imququ.com/post/content-security-policy-reference.html" target="_blank" rel="noopener">https://imququ.com/post/content-security-policy-reference.html</a></p>
</blockquote>
<ul>
<li>Aliexpress 使用案例<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">content-security-policy-report-only: <span class="keyword">default</span>-src * <span class="string">'unsafe-eval'</span> <span class="string">'unsafe-inline'</span>  data:;report-uri <span class="comment">//pointman.alibaba.com/csp?app=ae_default</span></span><br><span class="line">strict-transport-security: max-age=<span class="number">31536000</span> ; includeSubDomains</span><br><span class="line">strict-transport-security: max-age=<span class="number">31536000</span></span><br><span class="line">x-content-type-options: nosniff</span><br><span class="line">x-frame-options: DENY</span><br><span class="line">x-xss-protection: <span class="number">1</span>; mode=block</span><br></pre></td></tr></table></figure></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/06/https/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr.J">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/logo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hey">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/2020/06/06/https/" class="post-title-link" itemprop="url">HTTPS（HTTP over SSL/TLS）</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-06-06 17:22:00 / Modified: 09:36:31" itemprop="dateCreated datePublished" datetime="2020-06-06T17:22:00+00:00">2020-06-06</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/TCP-IP/" itemprop="url" rel="index"><span itemprop="name">TCP/IP</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2020/06/06/https/" class="leancloud_visitors" data-flag-title="HTTPS（HTTP over SSL/TLS）">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">Views: </span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="HTTPS-（HTTP-over-SSL）"><a href="#HTTPS-（HTTP-over-SSL）" class="headerlink" title="HTTPS （HTTP over SSL）"></a>HTTPS （HTTP over SSL）</h2><p>HTTPS(HTTP over SSL/TLS)实际上就是HTTP(HyperText Transfer Protocol) 超文本运输协议)和SSL(安全套接层协议)或TLS(安全运输层协议)的组合使用达到加密HTTP的效果。TLS分为记录协议和握手协议，是规范化的SSL。采用对称加密和非对称加密，两种方法并用的混合加密方式。在密钥交换环节使用非对称加密，报文传输环节使用对称加密。</p>
<p>互联网不是某个国家、组织、个人的私有物，在这种中间极有可能遭到恶意窥视。<br>HTTP协议是一个很单纯的协议，它只会傻傻的去请求并、响应，因此就有人利用它的傻白甜做一些不好的事情。<br>由于通信内容是未加密的，即使在通信的过程中使用了POST请求，但数据包在网络中是流动的，其内容很容易被一些抓包工具嗅探到，就会出现以下几种问题。</p>
<h3 id="HTTPS的存在主要是为了解决："><a href="#HTTPS的存在主要是为了解决：" class="headerlink" title="HTTPS的存在主要是为了解决："></a>HTTPS的存在主要是为了解决：</h3><ol>
<li><p>HTTP是明文传输，第三方使用抓包工具轻松的就能查看传输内容，传输内容可能遭到窃听；</p>
</li>
<li><p>HTTP是简单的协议，无法验证客户端的真实性，只负责请求和响应。无法阻止海量请求(DOS)、分布式海量请求(DDOS)。</p>
</li>
<li><p>无法验证服务端的真实性，服务端身份伪装，无法证明传输报文的完整性，传输内容可能遭篡改，即MITM中间人攻击(Man In The MiddleAttack)。</p>
</li>
</ol>
<p>HTTP明文通信<br><img src="https://ruixiaojia-blog.oss-cn-hangzhou.aliyuncs.com/blog/http/http.png?x-oss-process=style/compression" alt="HTTP"></p>
<p>TLS加密通信<br><img src="https://ruixiaojia-blog.oss-cn-hangzhou.aliyuncs.com/blog/http/TLS.png?x-oss-process=style/compression" alt="TLS"></p>
<p><strong> 通常HTTP是直接和TCP通信的，SSL是独立的协议，处于HTTP之下TCP之上，由SSL来加密、认证传输内容。实际上HTTPS就是添加了身份验证、报文加密、报文完整性校验的HTTP，也可以理解为身披SSL的HTTP。</strong></p>
<h3 id="HTTPS的交互过程"><a href="#HTTPS的交互过程" class="headerlink" title="HTTPS的交互过程"></a>HTTPS的交互过程</h3><p>– HTTPS传输过程分为两次HTTP请求：</p>
<ol>
<li>客户端向服务端发起第一次请求，连接443端口。</li>
<li>服务端收到请求后将自己的公钥使用CA的私钥进行加密生成密文，并添加过期时间、颁发给、颁发者、加密算法等信息，生成数字证书</li>
<li>服务端将数字证书发送至客户端。</li>
<li>客户端收到数字证书后会使用本地证书CA的公钥对其进行验证，确保数字证书来自真实请求的服务端，并验证证书的过期时间、当前访问服务器的域名等信息。验证有问题则此次通信结束。验证通过则客户端生成一个随机值(对称加密秘钥，用于密文加密解密)，使用服务端发来的公钥对随机值进行加密，第一次HTTP请求结束。</li>
<li>客户端发起第二次请求，将加密后的秘钥发送给服务端。</li>
<li>服务端接收到客户端发来的密文后使用私钥对密文进行解密，得到客户端生成的随机值(秘钥)。</li>
<li>将数据使用秘钥加密后发送至客户端。</li>
<li>客户端收到密文后使用随机值(秘钥)进行解密，得到服务端发送来的数据，HTTPS通信结束。</li>
</ol>
<p>HTTPS采用对称加密和非对称加密，两种加密方式并用的混合加密机制，在交换秘钥环节使用对称加密，报文交换阶段使用非对称加密方式，交换秘钥环节使用对称加密很容易遭到中间人攻击（MITM）至秘钥泄露或者被替换，这时候就要用到证书，证书会对该公钥进行数字签名，并将这个已签名的公钥和证书绑定在一起，以保证非对称加密过程的安全。</p>
<p>加密解密的过程会消耗CPU及内存资源，SSL通信也会占用部分网络资源。</p>
<h3 id="HTTPS解决了明文传输和身份验证的问题那么如何预防DDOS攻击："><a href="#HTTPS解决了明文传输和身份验证的问题那么如何预防DDOS攻击：" class="headerlink" title="HTTPS解决了明文传输和身份验证的问题那么如何预防DDOS攻击："></a>HTTPS解决了明文传输和身份验证的问题那么如何预防DDOS攻击：</h3><ol>
<li>使用图片验证或验证码，区分真实用户和肉鸡程序。</li>
<li>根据客户端发起秘钥交换的次数来判别是否可疑。</li>
<li>通过庞大的CDN集群，消化DDOS攻击流量，减轻服务器压力。</li>
<li>加密解密的过程需要CPU来完成，提高客户端的密钥解密的难度。</li>
</ol>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/11/01/redux/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr.J">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/logo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hey">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/11/01/redux/" class="post-title-link" itemprop="url">redux、react-redux</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-11-01 09:43:29" itemprop="dateCreated datePublished" datetime="2019-11-01T09:43:29+00:00">2019-11-01</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2020-06-06 09:36:31" itemprop="dateModified" datetime="2020-06-06T09:36:31+00:00">2020-06-06</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/React/" itemprop="url" rel="index"><span itemprop="name">React</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2019/11/01/redux/" class="leancloud_visitors" data-flag-title="redux、react-redux">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">Views: </span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Redux"><a href="#Redux" class="headerlink" title="Redux"></a>Redux</h1><p>对状态变化的处理会随着项目的复杂程度提高变的很糟糕。直到你搞不清楚当一个状态改变时会都会引起什么样的变化。</p>
<h2 id="简介："><a href="#简介：" class="headerlink" title="简介："></a>简介：</h2><ol>
<li><p>redux的诞生就是为了给应用提供‘可预测化的状态管理’</p>
</li>
<li><p>redux会将整个应用的状态（即数据）存储到一个地方 – store，适用createStore方法来创建一个store，该方法接收三个参数reducer、preloadedState、enhancer</p>
</li>
<li><p>store中保存着一棵状态树（state tree）</p>
</li>
<li><p>改变状态唯一的方法就是通过store的dispatch方法，触发一个action。这个action会被对应的reducer处理，reducer为纯函数，接收state和action，返回新的state。</p>
</li>
<li><p>组件通过派发（dispatch）一个行为（action）给reducer来描述发生了什么，reducer接收state和action，根据action的描述来处理对应的事情，处理完后返回新的state给store，其它的组件可以通过订阅store中state的变化来做一些事情。</p>
</li>
</ol>
<h2 id="redux有三大原则："><a href="#redux有三大原则：" class="headerlink" title="redux有三大原则："></a>redux有三大原则：</h2><ol>
<li><p>单一数据源：所有的state都以一个对象树的形式保存在一个单一的store中。</p>
</li>
<li><p>state只读：只能通过触发action来修改state，将所有state修改集中化处理。</p>
</li>
<li><p>使用纯函数来修改：reducer接收state、action，并返回新的state。</p>
</li>
</ol>
<h2 id="redux的构成"><a href="#redux的构成" class="headerlink" title="redux的构成"></a>redux的构成</h2><p>redux对外暴露五个方法，createStore、combineReducers、bindActionCreators、applyMiddleware、compose。</p>
<h3 id="createStore"><a href="#createStore" class="headerlink" title="createStore"></a>createStore</h3><p>createStore方法为redux的核心，该方法接收三个参数reducer(function)、preloadedState、enhancer(function),<br>并在函数内部创建监听事件列表(Array), 保存当前的state。<br>最后store返回四个方法, dispatch、subscribe、getState、replaceReducer。<br>在createState的最后调用一遍dispatch，传递一个Symbol作为action，触发reducer，让state的初始状态生效。</p>
<h3 id="combineReducers"><a href="#combineReducers" class="headerlink" title="combineReducers"></a>combineReducers</h3><p>该方法接收一个reducers(function)，将多个reducer合并，最终生成一个整体的reducer函数，<br>根据state的key去执行对应的子reducer，最后将返回结果合并成一个state tree。</p>
<h3 id="bindActionCreators"><a href="#bindActionCreators" class="headerlink" title="bindActionCreators"></a>bindActionCreators</h3><p>该方法接收一个Function/Object和dispatch方法，返回一个被dispatch包裹的action的方法，该方法主要是简化dispatch方法的调用。</p>
<h3 id="compose"><a href="#compose" class="headerlink" title="compose"></a>compose</h3><p>该方法的参数为函数，compose执行返回一个函数，该函数会将所有参数函数从右向左依次执行，<br>且每一个参数函数执行返回的结果将作为下一个参数函数的参数。compose函数接收的参数为第一次执行的参数。<br>把复杂的多函数嵌套调用组合成纯粹的函数调用: fn1(fn2(fn3(fn3(…args)))) ===&gt; compose(fn1,fn2,fn3,fn4)(…args)</p>
<h3 id="applyMiddleware"><a href="#applyMiddleware" class="headerlink" title="applyMiddleware"></a>applyMiddleware</h3><p>扩展Redux的一种推荐方式，可以让你包装store的dispatch方法。同时还拥有可组合性，将多个middleware组合起来形成middleware链。</p>
<h2 id="redux的原理实际上就是闭包和发布订阅模式的很好的实践。"><a href="#redux的原理实际上就是闭包和发布订阅模式的很好的实践。" class="headerlink" title="redux的原理实际上就是闭包和发布订阅模式的很好的实践。"></a>redux的原理实际上就是闭包和发布订阅模式的很好的实践。</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 简单的发布订阅模式</span></span><br><span class="line"><span class="keyword">let</span> state = &#123; <span class="attr">count</span>: <span class="number">1</span> &#125;</span><br><span class="line"><span class="keyword">let</span> listeners = [] <span class="comment">// 订阅的事件列表</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">subscribe</span>(<span class="params">listener</span>) </span>&#123; <span class="comment">// 订阅事件</span></span><br><span class="line">  listeners.push(listener)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">publish</span>(<span class="params">count</span>) </span>&#123; <span class="comment">// 一旦发布，即调用订阅的所有事件</span></span><br><span class="line">  state.count = count</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; listeners.length; i++) &#123;</span><br><span class="line">    <span class="keyword">let</span> listener = listeners[i]</span><br><span class="line">    listener()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">subscribe(<span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="comment">// 订阅打印state的事件</span></span><br><span class="line">  <span class="built_in">console</span>.log(state)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 发布状态，触发订阅的事件。</span></span><br><span class="line">publish(<span class="number">1</span>) <span class="comment">// &#123;count: 1&#125;</span></span><br><span class="line">publish(<span class="number">2</span>) <span class="comment">// &#123;count: 2&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="简单版redux实现"><a href="#简单版redux实现" class="headerlink" title="简单版redux实现"></a>简单版redux实现</h2><h3 id="createStore-1"><a href="#createStore-1" class="headerlink" title="createStore"></a>createStore</h3><p>该方法接收三个参数reducer（function）、preloadedState、enhancer（function），并返回四个方法dispatch、subscribe、getState、replaceReducer供store使用。</p>
<ul>
<li><p>reducer接收state、action作为参数，并返回处理后的state，该方法内需要处理state的初始状态，否则为undefined。</p>
</li>
<li><p>preloadedState在传递reducer之前设置初始state，可以选择从服务器中获取状态或用于恢复用户历史状态。</p>
</li>
<li><p>enhancer，store的增强器</p>
</li>
<li><p>dispatch方法是改变redux中state的唯一方法。接收一个action作为参数，并返回一个action。</p>
<p>该方法调用当前的reducer，然后将当前的state赋值为reducer处理完毕后返回的state。</p>
<p>最后dispatch将store中监听的事件列表遍历执行一遍。</p>
</li>
<li><p>subscribe方法接受一个listener(function)作为参数，该方法将listener添加到store监听的事件列表中。</p>
<p>最后返回一个unsubscribe(function)，用于将listener从store监听的事件列表中移除。</p>
</li>
<li><p>getState方法返回当前的state。</p>
</li>
<li><p>replaceReducer方法接受一个nextReducer作为参数，将当前的reducer替换为nextReducer，</p>
</li>
</ul>
<p>在createState的最后调用一遍dispatch，传递一个Symbol作为action，触发reducer，让state的初始状态生效。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createStore</span>(<span class="params">reducer, preloadedState, enhancer</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> currentReducer = reducer</span><br><span class="line">    <span class="keyword">let</span> currentState = preloadedState;</span><br><span class="line">    <span class="keyword">let</span> currentListeners = [];</span><br><span class="line">    <span class="keyword">let</span> nextListeners = currentListeners;</span><br><span class="line">    <span class="keyword">let</span> isDispatching = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> enhancer !== <span class="string">'undefined'</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> enhancer(createStore)(reducer, preloadedState)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">ensureCanMutateNextListeners</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (nextListeners === currentListeners) &#123;</span><br><span class="line">          	nextListeners = currentListeners.slice()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">dispatch</span>(<span class="params">action</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            isDispatching = <span class="literal">true</span></span><br><span class="line">            currentState = currentReducer(currentState, action)</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">          	isDispatching = <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> listeners = (currentListeners = nextListeners)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; listeners.length; i++) &#123;</span><br><span class="line">            <span class="keyword">const</span> listener = listeners[i]</span><br><span class="line">            listener()</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> action;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">subscribe</span>(<span class="params">listener</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!isDispatching) &#123;</span><br><span class="line">            <span class="keyword">let</span> isSubscribe = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">            ensureCanMutateNextListeners()</span><br><span class="line">            nextListeners.push(listener)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">unsubscribe</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (!isSubscribe) <span class="keyword">return</span>;</span><br><span class="line">            isSubscribe = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">            ensureCanMutateNextListeners()</span><br><span class="line">            <span class="keyword">const</span> index = nextListeners.indexOf(listener);</span><br><span class="line">            nextListeners.slice(index, <span class="number">1</span>)</span><br><span class="line">            currentListeners = <span class="literal">null</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getState</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!isDispatching) &#123;</span><br><span class="line">          	<span class="keyword">return</span> currentState;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">replaceReducer</span>(<span class="params">nextReducer</span>) </span>&#123;</span><br><span class="line">        currentReducer = nextReducer</span><br><span class="line">        dispatch(&#123; <span class="attr">type</span>: <span class="built_in">Symbol</span>() &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 用一个不匹配任何action的type, 来触发state = reducer(state, action), 获取初始值</span></span><br><span class="line">    dispatch(&#123; <span class="attr">type</span>: <span class="built_in">Symbol</span>() &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        dispatch,</span><br><span class="line">        getState,</span><br><span class="line">        subscribe,</span><br><span class="line">        replaceReducer,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="combineReducers-1"><a href="#combineReducers-1" class="headerlink" title="combineReducers"></a>combineReducers</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> combineReducers = <span class="function"><span class="params">reducers</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">(<span class="params">state = &#123;&#125;, action</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Object</span>.keys(reducers).reduce(</span><br><span class="line">            (nextState, key) =&gt; &#123;</span><br><span class="line">                nextState[key] = reducers[key](state[key], action);</span><br><span class="line">                <span class="keyword">return</span> nextState;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;&#125; </span><br><span class="line">        );</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="bindActionCreators-1"><a href="#bindActionCreators-1" class="headerlink" title="bindActionCreators"></a>bindActionCreators</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bindActionCreator</span>(<span class="params">actionCreator, dispatch</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dispatch(actionCreator.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bindActionCreators</span>(<span class="params">actionCreators, dispatch</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> actionCreators === <span class="string">'function'</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> bindActionCreator(actionCreators, dispatch)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> boundActionCreators = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> actionCreators) &#123;</span><br><span class="line">        <span class="keyword">const</span> actionCreator = actionCreators[key]</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> actionCreator === <span class="string">'function'</span>) &#123;</span><br><span class="line">        boundActionCreators[key] = bindActionCreator(actionCreator, dispatch)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> boundActionCreators</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// example:</span></span><br><span class="line">    <span class="comment">// Function</span></span><br><span class="line">    <span class="keyword">let</span> bindAction = bindActionCreators(<span class="function"><span class="params">a</span> =&gt;</span> (&#123; <span class="attr">type</span>: <span class="string">'INCREMENT'</span>, <span class="attr">params</span>: a &#125;), store.dispatch)</span><br><span class="line">    bindAction(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Object</span></span><br><span class="line">    <span class="keyword">let</span> bindAction = bindActionCreators(&#123;</span><br><span class="line">        INCREMENT: <span class="function">(<span class="params">a</span>) =&gt;</span> (&#123; <span class="attr">type</span>: <span class="string">'INCREMENT'</span>, <span class="attr">params</span>: a &#125;),</span><br><span class="line">        DECREMENT: <span class="function">(<span class="params">a</span>) =&gt;</span> (&#123; <span class="attr">type</span>: <span class="string">'DECREMENT'</span>, <span class="attr">params</span>: a &#125;)</span><br><span class="line">    &#125;, store.dispatch)</span><br><span class="line">    bindAction.INCREMENT(<span class="number">1</span>)</span><br><span class="line">    bindAction.DECREMENT(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<h3 id="compose-1"><a href="#compose-1" class="headerlink" title="compose"></a>compose</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">compose</span>(<span class="params">...funcs</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (funcs.length === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="params">arg</span> =&gt;</span> arg</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (funcs.length === <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> funcs[<span class="number">0</span>]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> funcs.reduce(<span class="function">(<span class="params">a, b</span>) =&gt;</span> (...args) =&gt; a(b(...args)))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="applyMiddleware-1"><a href="#applyMiddleware-1" class="headerlink" title="applyMiddleware"></a>applyMiddleware</h3><p>每个middleware接受store的dispatch和getState函数作为命名参数，并返回一个函数。<br>该函数会被传入一个叫next的方法，这个next方法是下一个middleware的dispatch方法，并返回一个接收action的新函数。<br>这个函数可以直接调用next(action)。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">applyMiddleware</span>(<span class="params">...middlewares</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">createStore</span> =&gt;</span> (...args) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> store = createStore(...args)</span><br><span class="line">        <span class="keyword">let</span> dispatch = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(</span><br><span class="line">                <span class="string">'Dispatching while constructing your middleware is not allowed. '</span> +</span><br><span class="line">                <span class="string">'Other middleware would not be applied to this dispatch.'</span></span><br><span class="line">            )</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> middlewareAPI = &#123;</span><br><span class="line">            getState: store.getState,</span><br><span class="line">            dispatch: <span class="function">(<span class="params">...args</span>) =&gt;</span> dispatch(...args)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">const</span> chain = middlewares.map(<span class="function"><span class="params">middleware</span> =&gt;</span> middleware(middlewareAPI))</span><br><span class="line">        dispatch = compose(...chain)(store.dispatch)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            ...store,</span><br><span class="line">            dispatch</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// example:</span></span><br><span class="line"><span class="keyword">const</span> logger = <span class="function">(<span class="params">&#123; getState, dispacth &#125;</span>) =&gt;</span> next =&gt; <span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'老状态'</span>, getState());</span><br><span class="line">    next(action);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'新状态'</span>,getState());</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> store = applyMiddleware(logger)(createStore)(reducer);</span><br></pre></td></tr></table></figure>
<hr>
<h1 id="React-Redux"><a href="#React-Redux" class="headerlink" title="React-Redux"></a>React-Redux</h1>
          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/22/ECMAScript6—part-two/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr.J">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/logo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hey">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/22/ECMAScript6—part-two/" class="post-title-link" itemprop="url">ES6标准入门 -- 学习笔记 (下)</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-07-22 22:41:50" itemprop="dateCreated datePublished" datetime="2019-07-22T22:41:50+00:00">2019-07-22</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2020-06-06 09:36:31" itemprop="dateModified" datetime="2020-06-06T09:36:31+00:00">2020-06-06</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/JavaScript/" itemprop="url" rel="index"><span itemprop="name">JavaScript</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2019/07/22/ECMAScript6—part-two/" class="leancloud_visitors" data-flag-title="ES6标准入门 -- 学习笔记 (下)">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">Views: </span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Class"><a href="#Class" class="headerlink" title="Class"></a>Class</h2><p>ES6中的Class写法只是让对象原型的写法更加清晰，更像面向对象编程 ( Object Oriented Programming，OOP ), 于构造函数用法完全一致。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ES5</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Fun</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.x = x</span><br><span class="line">    <span class="keyword">this</span>.y = y</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Fun.prototype.plus = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.x + <span class="keyword">this</span>.y</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> num = <span class="keyword">new</span> Fun(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">num.plus() <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ES6</span></span><br><span class="line"><span class="comment">// 类的内部默认使用严格模式，不需要再显示声明。</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fun</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(x, y) &#123;</span><br><span class="line">        <span class="comment">// 类的原型方法，使用new关键字则自动调用该方法</span></span><br><span class="line">        <span class="comment">// 若未声明该方法，则会默认添加一个空的constructor方法</span></span><br><span class="line">        <span class="keyword">this</span>.x = x</span><br><span class="line">        <span class="keyword">this</span>.y = y</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 默认return this;</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    plus() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.x + <span class="keyword">this</span>.y</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> num = <span class="keyword">new</span> Fun(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">num.plus() <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typeof</span> Fun <span class="comment">// "function"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 所有方法不可枚举</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.keys(Fun.prototype) <span class="comment">// []</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 所有实例共享同一个原型对象</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> num1 = <span class="keyword">new</span> Fun(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"><span class="keyword">let</span> num2 = <span class="keyword">new</span> Fun(<span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">num1.__proto__ === num2.__proto__ <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// class表达式</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> name = <span class="keyword">new</span> <span class="class"><span class="keyword">class</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">this</span>.name = <span class="string">'j.'</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">console</span>() &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.name)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">name.console() <span class="comment">// 'j.'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 类不存在变量提升</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Fun() <span class="comment">// Cannot access 'Fun' before initialization</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fun</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 私有方法</span></span><br><span class="line"><span class="comment">// ES6不提供私有方法，但可使用其他方法实现</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法一</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Widget</span> </span>&#123;</span><br><span class="line">    foo(options) &#123;</span><br><span class="line">        <span class="keyword">this</span>._bar(options)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 方法前加_表示为私有方法，但在类的外部依旧可以调用该方法。</span></span><br><span class="line">    _bar(options)&#123;</span><br><span class="line">        <span class="keyword">return</span> options;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法二</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Widget</span> </span>&#123;</span><br><span class="line">    foo(options) &#123;</span><br><span class="line">        bar.call(<span class="keyword">this</span>, options)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> options;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法三 使用Symbol</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Widget</span> </span>&#123;</span><br><span class="line">    foo(options) &#123;</span><br><span class="line">        <span class="keyword">this</span>[bar](options)</span><br><span class="line">    &#125;</span><br><span class="line">    [bar](options) &#123;</span><br><span class="line">        <span class="keyword">return</span> options;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 私有方法（提案）在变量或函数前加#</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Widget</span> </span>&#123;</span><br><span class="line"><span class="comment">//    #a;</span></span><br><span class="line"><span class="comment">//    #fun() &#123;</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="this指向"><a href="#this指向" class="headerlink" title="this指向"></a>this指向</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 类的方法中的this默认指向类的实例，在外部调用类的方法时this指向可能会指向运行环境。</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Logger</span> </span>&#123;</span><br><span class="line">    print(name = <span class="string">'J'</span>)&#123;</span><br><span class="line">        <span class="keyword">this</span>.console(name)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">console</span>(name) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(name)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> logger = <span class="keyword">new</span> Logger()</span><br><span class="line"><span class="keyword">const</span> &#123; print &#125; = logger</span><br><span class="line">print() <span class="comment">// Cannot read property 'console' of undefined</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法一</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Logger</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">this</span>.print = <span class="keyword">this</span>.print.bind(<span class="keyword">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法二 箭头函数</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Logger</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.print = <span class="function">(<span class="params">name = <span class="string">'J'</span></span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.console(name)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法三 Proxy</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">selfish</span>(<span class="params">target</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> cache = <span class="keyword">new</span> <span class="built_in">WeakMap</span>()</span><br><span class="line">    <span class="keyword">const</span> handler = &#123;</span><br><span class="line">        <span class="keyword">get</span> (target, key) &#123;</span><br><span class="line">            <span class="keyword">const</span> val = <span class="built_in">Reflect</span>.get(target, key)</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> val !== <span class="string">'function'</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> val;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (!cache.has(val)) &#123;</span><br><span class="line">                cache.set(val, val.bind(target))</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> cache.get(val)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> proxy = <span class="keyword">new</span> <span class="built_in">Proxy</span>(target, handler)</span><br><span class="line">    <span class="keyword">return</span> proxy</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> a = selfish(<span class="keyword">new</span> Logger())</span><br><span class="line"><span class="keyword">const</span> &#123; pring &#125; = a</span><br><span class="line">pring() <span class="comment">// J</span></span><br></pre></td></tr></table></figure>
<h3 id="getter、setter"><a href="#getter、setter" class="headerlink" title="getter、setter"></a>getter、setter</h3><p>可使用get、set关键字对类内部的某个属性设置存值函数(setter)和取值函数(getter)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Myclass</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">this</span>.name = <span class="string">'jjj'</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">get</span> prop () &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">set</span> prop (val) &#123;</span><br><span class="line">        <span class="keyword">this</span>.name = val</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.name)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> myclass = <span class="keyword">new</span> Myclass()</span><br><span class="line">myclass.prop = <span class="string">'xxx'</span> <span class="comment">// 'xxx'</span></span><br><span class="line"><span class="built_in">console</span>.log(myclass.prop) <span class="comment">// 'xxx'</span></span><br></pre></td></tr></table></figure>
<h3 id="class的静态方法"><a href="#class的静态方法" class="headerlink" title="class的静态方法"></a>class的静态方法</h3><p>类相当于实例的原型，所有在类上定义的方法都会被实例继承，类的方法前加static关键字则不能被实例继承，只能通过类调用，称为“静态方法”。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> hello() &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'hello'</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'hello'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 在类上调用</span></span><br><span class="line">Foo.hello() <span class="comment">// hello</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 在类的实例上调用</span></span><br><span class="line"><span class="keyword">let</span> foo = <span class="keyword">new</span> Foo() <span class="comment">// Uncaught TypeError: foo.hello is not a function</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 父类的静态方法可以被子类继承，子类也可以通过super调用该方法</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Son</span> <span class="keyword">extends</span> <span class="title">Foo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> method() &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">super</span>.hello() + <span class="string">' world'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过子类调用</span></span><br><span class="line">Son.hello() <span class="comment">// hello</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 从super对象上调用</span></span><br><span class="line">Son.method() <span class="comment">// hello</span></span><br><span class="line">            <span class="comment">// hello world</span></span><br></pre></td></tr></table></figure>
<h3 id="class的静态属性和实例属性"><a href="#class的静态属性和实例属性" class="headerlink" title="class的静态属性和实例属性"></a>class的静态属性和实例属性</h3><p>静态属性是Class本身的属性，即Class.prop，而不是定义在实例对象this上的属性。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 实例属性</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span> </span>&#123;</span><br><span class="line">    state = <span class="string">'state'</span></span><br><span class="line">    method() &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.state)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> foo = <span class="keyword">new</span> Foo()</span><br><span class="line">foo.hello() <span class="comment">// state</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 静态属性</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> state = <span class="string">'state'</span></span><br><span class="line">    method() &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.state)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> Foo()</span><br><span class="line">a.method() <span class="comment">// Foo.state = state</span></span><br><span class="line">          <span class="comment">// this.state = undefined</span></span><br><span class="line"><span class="built_in">console</span>.log(a.state) <span class="comment">// undefined</span></span><br><span class="line"><span class="built_in">console</span>.log(Foo.state) <span class="comment">// state</span></span><br></pre></td></tr></table></figure>
<h3 id="new-target属性"><a href="#new-target属性" class="headerlink" title="new.target属性"></a>new.target属性</h3><p>在class内部调用new.target属性，如果是通过new命令调用的会返回该类，如果不是则返回undefined</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">new</span>.target)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">new</span> Foo() <span class="comment">// class Foo &#123;</span></span><br><span class="line">         <span class="comment">//     constructor() &#123;</span></span><br><span class="line">         <span class="comment">//         console.log(new.target)</span></span><br><span class="line">         <span class="comment">//     &#125;</span></span><br><span class="line">         <span class="comment">// &#125;</span></span><br><span class="line">         </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span> </span>&#123;</span><br><span class="line">    method() &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">new</span>.target)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> foo = <span class="keyword">new</span> Foo()</span><br><span class="line">foo.method() <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure>
<h3 id="class继承"><a href="#class继承" class="headerlink" title="class继承"></a>class继承</h3><p>在ES5中继承实际是先创造子类的实例对象this，然后再将父类的方法添加到this上面。</p>
<p>在ES6中，子类在继承父类时实际上是继承父类的this对象，然后对其加工得到自己的this。必须在constructor中通过调用super方法，来调用父类的构造函数并新建父类的this对象，否则会报错。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(x, y) &#123;</span><br><span class="line">        <span class="keyword">this</span>.x = x</span><br><span class="line">        <span class="keyword">this</span>.y = y</span><br><span class="line"></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'foo'</span>, x ,y)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    method() &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'foo method'</span>, <span class="keyword">this</span>.x, <span class="keyword">this</span>.y)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Son</span> <span class="keyword">extends</span> <span class="title">Foo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(x, y) &#123;</span><br><span class="line">        <span class="keyword">super</span>(x, y) <span class="comment">// super作为函数调用时代表父类的构造函数，且只能在constructor中使用。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="built_in">console</span>.log(x, y)</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.x, <span class="keyword">this</span>.y)</span><br><span class="line">        <span class="keyword">super</span>.method() <span class="comment">// super作为对象时指向父类的原型，可以调用父类的方法，super.method()相当于Foo.prototype.method()</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Son(<span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="comment">// foo 2 3</span></span><br><span class="line"><span class="comment">// 2 3</span></span><br><span class="line"><span class="comment">// 2 3</span></span><br><span class="line"><span class="comment">// foo method 2 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断一个类是否继承了另一个类</span></span><br><span class="line"><span class="built_in">Object</span>.getPrototypeOf(Son) === Foo <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<h3 id="类的prototype属性和proto属性"><a href="#类的prototype属性和proto属性" class="headerlink" title="类的prototype属性和proto属性"></a>类的prototype属性和<strong>proto</strong>属性</h3><p>子类的<strong>proto</strong>属性标识构造函数的继承，总是指向父类</p>
<p>子类的prototype属性的<strong>proto</strong>属性表示方法的继承，总是指向父类的prototype</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span> </span>&#123;</span><br><span class="line">    FooMethod() &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Son</span> <span class="keyword">extends</span> <span class="title">Foo</span> </span>&#123;</span><br><span class="line">    SonMethod () &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(Son.__proto__ === Foo) <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(Son.prototype.__proto__ === Foo.prototype) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<h3 id="实例的-proto属性"><a href="#实例的-proto属性" class="headerlink" title="实例的__proto属性"></a>实例的__proto属性</h3><p>子类实例的<strong>proto</strong>属性的<strong>proto</strong>属性指向父类实例的<strong>proto</strong>属性。即子类原型的原型是父类的原型。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span> </span>&#123;</span><br><span class="line">    FooMethod() &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Son</span> <span class="keyword">extends</span> <span class="title">Foo</span> </span>&#123;</span><br><span class="line">    SonMethod () &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> foo = <span class="keyword">new</span> Foo()</span><br><span class="line"><span class="keyword">let</span> son = <span class="keyword">new</span> Son()</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(son.__proto__.__proto__ === foo.__proto__) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<h2 id="Proxy"><a href="#Proxy" class="headerlink" title="Proxy"></a>Proxy</h2><p>Proxy用于修改某些操作的默认行为，可以理解为在目标对象前架设了‘拦截层’，任何对该对象的操作都必须先通过Proxy。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// target: 要拦截的目标对象。</span></span><br><span class="line"><span class="comment">// handler: 拦截行为。</span></span><br><span class="line"><span class="keyword">var</span> proxy = <span class="keyword">new</span> <span class="built_in">Proxy</span>(target, handler)</span><br></pre></td></tr></table></figure>
<h3 id="实例方法"><a href="#实例方法" class="headerlink" title="实例方法:"></a>实例方法:</h3><h4 id="get"><a href="#get" class="headerlink" title="get()"></a>get()</h4><p>用于拦截某个属性的读取操作。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> o = &#123;</span><br><span class="line">    name: <span class="string">'j'</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> proxy = <span class="keyword">new</span> <span class="built_in">Proxy</span>(o, &#123;</span><br><span class="line">    <span class="keyword">get</span>: function(target, propKey) &#123;</span><br><span class="line">        <span class="keyword">if</span> (propKey <span class="keyword">in</span> target) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'get '</span> + propKey)</span><br><span class="line">            <span class="keyword">return</span> target[propKey]</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'没有'</span> + propKey)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(proxy.name) <span class="comment">// get name</span></span><br><span class="line">                     <span class="comment">// j</span></span><br><span class="line">                     </span><br><span class="line"><span class="comment">// get 方法可以继承</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj = <span class="built_in">Object</span>.create(proxy)</span><br><span class="line"><span class="built_in">console</span>.log(obj.age) <span class="comment">// 没有age</span></span><br><span class="line">                   <span class="comment">// undefined</span></span><br><span class="line">                   </span><br><span class="line"><span class="comment">// 实现读取数组负数索引</span></span><br><span class="line">arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line"><span class="keyword">let</span> proxy = <span class="keyword">new</span> <span class="built_in">Proxy</span>(arr, &#123;</span><br><span class="line">    <span class="keyword">get</span>: function(target, propKey) &#123;</span><br><span class="line">        <span class="keyword">let</span> index = <span class="built_in">Number</span>(propKey)</span><br><span class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            propKey = target.length + index</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Reflect</span>.get(target, propKey)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(proxy[<span class="number">-1</span>]) <span class="comment">// 5</span></span><br></pre></td></tr></table></figure>
<h4 id="set"><a href="#set" class="headerlink" title="set()"></a>set()</h4><p>用于拦截某个属性的赋值操作。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> proxy = <span class="keyword">new</span> <span class="built_in">Proxy</span>(&#123;&#125;, &#123;</span><br><span class="line">    <span class="keyword">set</span>: function(target, propKey, value) &#123;</span><br><span class="line">        <span class="keyword">if</span> (propKey === <span class="string">'age'</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="built_in">Number</span>.isInteger(value)) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">'The age is not an integer'</span>)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (value &gt; <span class="number">200</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">RangeError</span>(<span class="string">'The age seems invalid'</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            target[propKey] = value</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">proxy.age = <span class="number">100</span></span><br><span class="line"><span class="built_in">console</span>.log(proxy) <span class="comment">// Proxy &#123;age: 100&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="apply"><a href="#apply" class="headerlink" title="apply()"></a>apply()</h4><p>用于拦截函数调用、call、apply操作。<br>apply接受三个参数，目标对象、目标对象上下文(this)、目标对象参数数组</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> target = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">return</span> <span class="string">"I am the target"</span>&#125;</span><br><span class="line"><span class="keyword">let</span> prox = <span class="keyword">new</span> <span class="built_in">Proxy</span>(target, &#123;</span><br><span class="line">    apply(target, ctx, args) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(target())</span><br><span class="line">        <span class="built_in">console</span>.log(ctx)</span><br><span class="line">        <span class="built_in">console</span>.log(args)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">prox(<span class="number">1</span>, <span class="number">2</span>) <span class="comment">// I am the target</span></span><br><span class="line">          <span class="comment">// undefined</span></span><br><span class="line">          <span class="comment">// [1, 2]</span></span><br><span class="line">          </span><br><span class="line"><span class="keyword">let</span> plus = <span class="function"><span class="keyword">function</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> prox = <span class="keyword">new</span> <span class="built_in">Proxy</span>(plus, &#123;</span><br><span class="line">    apply(target, ctx, args) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Reflect</span>.apply(...arguments) * <span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">prox(<span class="number">2</span>, <span class="number">3</span>) <span class="comment">// 10</span></span><br><span class="line">prox.call(<span class="literal">null</span>, <span class="number">1</span>, <span class="number">2</span>) <span class="comment">// 6</span></span><br><span class="line">prox.apply(<span class="literal">null</span>, [<span class="number">3</span>, <span class="number">4</span>]) <span class="comment">// 14</span></span><br></pre></td></tr></table></figure>
<h4 id="has"><a href="#has" class="headerlink" title="has()"></a>has()</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="Reflect"><a href="#Reflect" class="headerlink" title="Reflect"></a>Reflect</h2><ul>
<li>从Reflect对象上可以获取语言内部的方法</li>
<li>修改某些Object对象的返回结果，使其合理</li>
<li>让Object操作都变成函数行为</li>
<li>无论Proxy如何修改默认行为，都可以在Reflect上获取默认行为</li>
</ul>
<h3 id="静态方法"><a href="#静态方法" class="headerlink" title="静态方法"></a>静态方法</h3><h4 id="Reflect-get"><a href="#Reflect-get" class="headerlink" title="Reflect.get()"></a>Reflect.get()</h4><h2 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h2><p>异步编程的一种解决方案，比传统的回调函数更合理更强大。<br>promise简单来说就是一个容器，里面保存着某个未来才会结束的事件的结果。<br>ES6规定promise对象是一个构造函数，用来生成promise实例。promise对象有三种状态：pending（进行中）、fulfilled（已成功）和rejected（已失败）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// promist构造函数接收一个函数作为参数，该函数接收两个函数resolve、reject作为参数。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// resolve函数将promise对象的状态从pinding变为resolved，在异步操作成功时调用。</span></span><br><span class="line"><span class="comment">// reject函数将promise对象的状态从pending变为rejected，在异步操作失败时调用。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        resolve(val)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        reject(error)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.prototype.then()</span><br><span class="line"><span class="comment">// promise实例生成后，可以使用then方法分别指定resolve和reject的回调函数。</span></span><br><span class="line">promise.then(<span class="function"><span class="keyword">function</span>(<span class="params">success</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// success回调</span></span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// error回调</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.prototype.catch()</span><br><span class="line"><span class="comment">// 用于指定发生错误时的回调函数，</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.all()</span><br><span class="line"><span class="comment">// 用于将多个Promise实例包装成一个新的Promise实例，该方法接受一个数组，数组成员均为promise实例。</span></span><br><span class="line"><span class="keyword">let</span> p = <span class="built_in">Promise</span>.all([p1, p2, p3])</span><br><span class="line"><span class="comment">// 只有所有实例成员的状态都变为resolved时，p的状态才会变成resolved。</span></span><br><span class="line"><span class="comment">// 只要有一个实例变成rejected，则p的状态变为rejected，返回变为rejected状态的实例的返回值。给每一个promise实例都添加catch回调，并return结果，这样就可以在最后的结果中都获取到。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.allSettled()</span><br><span class="line"><span class="comment">// 接受多个promise实例数组，只有等到所有参数实例都返回结果(不管成功失败)，该实例才会结束。Promise.all()无法确定所有请求都结束。想要达到这个目的，Promise.allSettled()就容易多了。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.race()</span><br><span class="line"><span class="comment">// 接受多个promise实例数组，哪个先resolved就返回哪个值。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.resolve(<span class="string">'foo'</span>)</span><br><span class="line"><span class="comment">// 等价于</span></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123; resolve(<span class="string">'foo'</span>) &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.reject(<span class="string">'foo'</span>)</span><br><span class="line"><span class="comment">// 等价于</span></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123; reject(<span class="string">'foo'</span>) &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.prototype.done()</span><br><span class="line"><span class="comment">// 处于回调链的最尾端，保证捕捉到可能出现的任何错误。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.prototype.finally() <span class="comment">// ES2018</span></span><br><span class="line"><span class="comment">// 不管Promise对象最后状态如何都会执行的操作，接受一个普通函数作为回调函数，不论如何都会执行。</span></span><br></pre></td></tr></table></figure>
<h2 id="Iterator-遍历器"><a href="#Iterator-遍历器" class="headerlink" title="Iterator 遍历器"></a>Iterator 遍历器</h2><p>为各种不同的数据结构提供的统一简便的访问接口(symbol.iterator)，供for…of遍历使用。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="string">'a'</span>, <span class="string">'b'</span>];</span><br><span class="line"><span class="keyword">let</span> iter = arr[<span class="built_in">Symbol</span>.iterator]();</span><br><span class="line"></span><br><span class="line">iter.next() <span class="comment">// &#123; value: 'a', done: false &#125;</span></span><br><span class="line">iter.next() <span class="comment">// &#123; value: 'b', done: false &#125;</span></span><br><span class="line">iter.next() <span class="comment">// &#123; value: undefined, done: true &#125;</span></span><br></pre></td></tr></table></figure>
<p>原生具备iterator接口的数据接口：Array、Map、Set、String、arguments、NodeList对象。除此之外都需要自己手动在Symbol.iterator属性上面部署，才会被for…of遍历。</p>
<p>除了for…of，还有一些会默认调用Symbol.iterator接口的场合，比如：解构赋值、扩展运算符、yield*、Array.from()、Map()、Set()、WeakMap()、WeakSet()、Promise.all()、Promise.race()</p>
<p>iterator遍历过程</p>
<ul>
<li>创建一个指针对象，指向当前数据的起始位置。</li>
<li>第一次调用指针对象的next方法，指针指向数据结构的第一个数据成员。</li>
<li>以此类推，直到指向数据结构的结束位置。</li>
</ul>
<p>手动部署Symbol.iterator</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// class</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RangeIterator</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(start, stop) &#123;</span><br><span class="line">    <span class="keyword">this</span>.value = start;</span><br><span class="line">    <span class="keyword">this</span>.stop = stop;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  [<span class="built_in">Symbol</span>.iterator]() &#123; <span class="keyword">return</span> <span class="keyword">this</span>; &#125;</span><br><span class="line">  </span><br><span class="line">  next() &#123;</span><br><span class="line">    <span class="keyword">var</span> value = <span class="keyword">this</span>.value;</span><br><span class="line">    <span class="keyword">if</span> (value &lt; <span class="keyword">this</span>.stop) &#123;</span><br><span class="line">      <span class="keyword">this</span>.value++;</span><br><span class="line">      <span class="keyword">return</span> &#123;<span class="attr">done</span>: <span class="literal">false</span>, <span class="attr">value</span>: value&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="attr">done</span>: <span class="literal">true</span>, <span class="attr">value</span>: <span class="literal">undefined</span>&#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> value <span class="keyword">of</span> <span class="keyword">new</span> RangeIterator(<span class="number">0</span>, <span class="number">3</span>)) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(value); <span class="comment">// 0, 1, 2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Object</span></span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">  data: [ <span class="string">'hello'</span>, <span class="string">'world'</span> ],</span><br><span class="line">  [<span class="built_in">Symbol</span>.iterator]() &#123;</span><br><span class="line">    <span class="keyword">const</span> self = <span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">let</span> index = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      next() &#123;</span><br><span class="line">        <span class="keyword">if</span> (index &lt; self.data.length) &#123;</span><br><span class="line">          <span class="keyword">return</span> &#123;</span><br><span class="line">            value: self.data[index++],</span><br><span class="line">            done: <span class="literal">false</span></span><br><span class="line">          &#125;;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> &#123; <span class="attr">value</span>: <span class="literal">undefined</span>, <span class="attr">done</span>: <span class="literal">true</span> &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> value <span class="keyword">of</span> obj) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(value); <span class="comment">// 'hello', 'world'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用Generator部署Symbol.iterator</span></span><br><span class="line"><span class="keyword">let</span> myIterable = &#123;</span><br><span class="line">  [<span class="built_in">Symbol</span>.iterator]: <span class="function"><span class="keyword">function</span>* (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">3</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">[...myIterable] <span class="comment">// [1, 2, 3]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 或者采用下面的简洁写法</span></span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">  * [<span class="built_in">Symbol</span>.iterator]() &#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="string">'hello'</span>;</span><br><span class="line">    <span class="keyword">yield</span> <span class="string">'world'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> x <span class="keyword">of</span> obj) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// "hello"</span></span><br><span class="line"><span class="comment">// "world"</span></span><br></pre></td></tr></table></figure>
<h2 id="Generator"><a href="#Generator" class="headerlink" title="Generator"></a>Generator</h2><p>Generator 函数是 ES6 提供的一种异步编程解决方案。语法上，首先可以把它理解成，Generator 函数是一个状态机，封装了多个内部状态。Generator 函数还是一个遍历器对象生成函数，可以使用for…of依次遍历 Generator 函数内部的每一个状态。</p>
<p>Generator与普通函数的区别在于需要在函数名前加*号，函数体内可以使用yield表达式，调用后不会直接执行，而是返回一个Iterator对象，调用该对象的next方法，直到遇到yield表达式或return为止。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">generator</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> generator = <span class="function"><span class="keyword">function</span>* (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 作为对象属性</span></span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">  myGeneratorMethod: <span class="function"><span class="keyword">function</span>* (<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 可简写为</span></span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">  * myGeneratorMethod() &#123;&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="yield表达式"><a href="#yield表达式" class="headerlink" title="yield表达式"></a>yield表达式</h3><p>yield表达式是Generator函数暂停的标识，且具备位置记忆功能。</p>
<ul>
<li>遇到<code>yield</code>表达式，就暂停执行后面的操作，并将紧跟在<code>yield</code>后面的那个表达式的值，作为返回的对象的<code>value</code>属性值。</li>
<li>下一次调用<code>next</code>方法时，再继续往下执行，直到遇到下一个<code>yield</code>表达式或<code>return</code>语句为止，并将<code>return</code>语句后面的表达式的值，作为返回的对象的<code>value</code>属性值。</li>
<li>如果该函数没有<code>return</code>语句，则返回的对象的<code>value</code>属性值为<code>undefined</code>。</li>
</ul>
<p>如果在Generator函数内部需要调用另一个Generator函数或调用iterator接口的话可以使用<code>yield*</code>表达式完成遍历。等同于在yield表达式后面部署了一个for…of循环。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">'a'</span>;</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">'b'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">bar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">'x'</span>;</span><br><span class="line">	<span class="keyword">yield</span>* foo();</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">'y'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> v <span class="keyword">of</span> bar())&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(v);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// x, a, b, y</span></span><br></pre></td></tr></table></figure>
<h3 id="Generator函数应用"><a href="#Generator函数应用" class="headerlink" title="Generator函数应用"></a>Generator函数应用</h3><ul>
<li>控制流管理</li>
<li>部署Iterator接口</li>
<li>作为数据结构</li>
<li>异步操作的同步化表达</li>
<li>异步应用（使用co模块做执行器）</li>
</ul>
<h2 id="async"><a href="#async" class="headerlink" title="async"></a>async</h2><p>Generator函数的语法糖，返回值为Promise，且自带执行器。</p>
<p>async函数返回一个Promise对象，必须等内部所有await执行完毕才会发生状态改变。如果await后面的异步操作出错，等同于async函数返回的Promise对象reject，最好使用try…catch包裹。</p>
<p>正常情况下await后面是一个Promise对象，返回该对象的结果，如果不是则直接返回。</p>
<p>注意：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 两个独立的异步操作（不互相依赖），被写成继发关系会比较耗时。</span></span><br><span class="line"><span class="comment">// example:</span></span><br><span class="line"><span class="keyword">let</span> foo = <span class="keyword">await</span> getFoo();</span><br><span class="line"><span class="keyword">let</span> bar = <span class="keyword">await</span> getBar();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 可让其同时触发</span></span><br><span class="line"><span class="comment">// 写法一</span></span><br><span class="line"><span class="keyword">let</span> [foo, bar] = <span class="keyword">await</span> <span class="built_in">Promise</span>.all([getFoo(), getBar()]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 写法二</span></span><br><span class="line"><span class="keyword">let</span> fooPromise = getFoo();</span><br><span class="line"><span class="keyword">let</span> barPromise = getBar();</span><br><span class="line"><span class="keyword">let</span> foo = <span class="keyword">await</span> fooPromise;</span><br><span class="line"><span class="keyword">let</span> bar = <span class="keyword">await</span> barPromise;</span><br></pre></td></tr></table></figure>
<h2 id="异步编程方法"><a href="#异步编程方法" class="headerlink" title="异步编程方法"></a>异步编程方法</h2><ul>
<li>回调函数</li>
<li>事件监听</li>
<li>发布/订阅</li>
<li>Promise</li>
<li>Generator</li>
<li>async</li>
</ul>
<h2 id="Decorator-装饰器"><a href="#Decorator-装饰器" class="headerlink" title="Decorator 装饰器"></a>Decorator 装饰器</h2><h3 id="类的装饰"><a href="#类的装饰" class="headerlink" title="类的装饰"></a>类的装饰</h3><p>在代码编译时，将类作为装饰器的第一个参数传入装饰器。可在类上添加静态属性或实例属性/方法。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@decorator</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 等同于</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;&#125;</span><br><span class="line">A = decorator(A) || A;</span><br></pre></td></tr></table></figure>
<h3 id="方法的装饰"><a href="#方法的装饰" class="headerlink" title="方法的装饰"></a>方法的装饰</h3><p>方法的装饰器接收三个参数，类的原型对象、所要装饰的属性名、该属性的描述对象。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  @readonly</span><br><span class="line">  name() &#123; <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.first&#125;</span> <span class="subst">$&#123;<span class="keyword">this</span>.last&#125;</span>`</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">readonly</span>(<span class="params">target, name, descriptor</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// descriptor对象原来的值如下</span></span><br><span class="line">  <span class="comment">// &#123;</span></span><br><span class="line">  <span class="comment">//   value: specifiedFunction,</span></span><br><span class="line">  <span class="comment">//   enumerable: false,</span></span><br><span class="line">  <span class="comment">//   configurable: true,</span></span><br><span class="line">  <span class="comment">//   writable: true</span></span><br><span class="line">  <span class="comment">// &#125;;</span></span><br><span class="line">  descriptor.writable = <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">return</span> descriptor;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注：由于存在函数提升，使得装饰器不能用于函数。类是不会提升的，所以就没有这方面的问题。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/22/ECMAScript6—part-one/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr.J">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/logo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hey">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/22/ECMAScript6—part-one/" class="post-title-link" itemprop="url">ES6标准入门 -- 学习笔记 (上)</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-07-22 22:41:49" itemprop="dateCreated datePublished" datetime="2019-07-22T22:41:49+00:00">2019-07-22</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2020-06-06 09:36:31" itemprop="dateModified" datetime="2020-06-06T09:36:31+00:00">2020-06-06</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/JavaScript/" itemprop="url" rel="index"><span itemprop="name">JavaScript</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2019/07/22/ECMAScript6—part-one/" class="leancloud_visitors" data-flag-title="ES6标准入门 -- 学习笔记 (上)">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">Views: </span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p><a href="http://es6.ruanyifeng.com/" target="_blank" rel="noopener">ECMAScript 6 入门</a></p>
</blockquote>
<h2 id="块级作用域"><a href="#块级作用域" class="headerlink" title="块级作用域"></a>块级作用域</h2><p>为什么需要块级作用域呢？</p>
<ul>
<li>内层变量可能覆盖外层变量。</li>
<li>用来计数的循环变量泄露为全局变量。</li>
</ul>
<p>块级作用域中内层变量可以读取外层作用域的变量，且内层作用域中的变量优先级高于外层作用域同名变量。</p>
<p>块级作用域的出现也使立即执行匿名函数不再必要。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ES6块级作用域</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">let</span> a = <span class="number">1</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">let</span> a = <span class="number">2</span></span><br><span class="line">        <span class="built_in">console</span>.log(a)  <span class="comment">// 2</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 立即执行匿名函数 (IIFE)</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;())</span><br></pre></td></tr></table></figure></p>
<p>避免在块级作用域内声明函数，如果需要，应写成函数表达式的形式，而不是函数声明语句<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 函数声明语句</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数表达式</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">let</span> a = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="let"><a href="#let" class="headerlink" title="let"></a>let</h2><p>使用let定义的变量，只在let命令所在的代码块内有效。</p>
<p>相同作用域内不能重复声明同一个变量。</p>
<p>在for循环中，这是循环变量的部分为父级作用域，循环体内为单独的子作用域。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123; <span class="comment">// 父作用域</span></span><br><span class="line">    <span class="comment">// 子作用域</span></span><br><span class="line">    <span class="keyword">let</span> i = <span class="number">10</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(i) <span class="comment">// 10</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>var命令会发生“变量提升”，可以在声明之前使用，值为undefined。let命令在它声明变量之前，该变量都是不可用的，称为“暂时性死区”。</p>
<h2 id="const"><a href="#const" class="headerlink" title="const"></a>const</h2><p>声明一个只读的常量，需立即赋值，一旦赋值就不能改变。</p>
<p>和let一样，也不会”变量提升“、存在”暂时性死区“、不可重复声明。</p>
<p>对于基本数据类型Number、Boolean、String而言，变量指向的是内存地址中，<br>对于复合数据类型Array、Object而言，变量指向的内存地址中保存的只是一个指针，const只能保证指针不变，不能保证其数据结构是否变化。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;&#125;</span><br><span class="line"><span class="comment">// 为obj添加一个属性</span></span><br><span class="line">obj.a = <span class="number">1</span> <span class="comment">// &#123; a: 1 &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 为obj重新赋值</span></span><br><span class="line">obg = <span class="number">1</span> <span class="comment">// Uncaught TypeError: Assignment to constant variable.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 冻结obj</span></span><br><span class="line"><span class="keyword">const</span> obj =  <span class="built_in">Object</span>.freeze(&#123;&#125;)</span><br><span class="line">obj.a = <span class="number">1</span> <span class="comment">// &#123;&#125;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="解构赋值"><a href="#解构赋值" class="headerlink" title="解构赋值"></a>解构赋值</h2><p>按照一定模式从对象或数组中提取值，然后对变量赋值，称为”解构赋值“。</p>
<h3 id="数组的解构赋值"><a href="#数组的解构赋值" class="headerlink" title="数组的解构赋值"></a>数组的解构赋值</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 两边模式相等，左边变量就会被赋予对应的值</span></span><br><span class="line"><span class="keyword">let</span> [a, b, c] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">a <span class="comment">// 1</span></span><br><span class="line">b <span class="comment">// 2</span></span><br><span class="line">c <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> [ , , d] = [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]</span><br><span class="line">d <span class="comment">//6</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> [e, ...f] = [<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]</span><br><span class="line">e <span class="comment">// 7</span></span><br><span class="line">f <span class="comment">// [8, 9]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果解构不成功，值为 undefined</span></span><br><span class="line"><span class="keyword">let</span> [g, h] = [<span class="number">10</span>]</span><br><span class="line">g <span class="comment">// 10</span></span><br><span class="line">h <span class="comment">// undefined</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 允许指定默认值</span></span><br><span class="line"><span class="comment">// 如果数组成员不严格等于undefined，默认值不会生效</span></span><br><span class="line"><span class="keyword">let</span> [i, j = <span class="number">2</span>] = [<span class="number">1</span>]</span><br><span class="line">i <span class="comment">// 1</span></span><br><span class="line">j <span class="comment">// 2</span></span><br></pre></td></tr></table></figure>
<h3 id="对象的解构赋值"><a href="#对象的解构赋值" class="headerlink" title="对象的解构赋值"></a>对象的解构赋值</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> &#123; <span class="attr">a</span>: c, <span class="attr">b</span>: b &#125; = &#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span> &#125;</span><br><span class="line"><span class="comment">// 其中a为模式，c是真正被赋值的变量</span></span><br><span class="line">c <span class="comment">// 1</span></span><br><span class="line">b <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 简写为</span></span><br><span class="line"><span class="comment">// 变量必须与属性同名</span></span><br><span class="line"><span class="keyword">let</span> &#123; a, b &#125; = &#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 嵌套</span></span><br><span class="line"><span class="keyword">let</span> &#123; c, <span class="attr">c</span>: &#123; d &#125; &#125; = &#123; <span class="attr">c</span>: &#123; <span class="attr">d</span>: <span class="number">3</span> &#125;&#125;</span><br><span class="line">c <span class="comment">// &#123; d: 3 &#125;</span></span><br><span class="line">d <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 默认值，对象的属性值必须严格等于 undefined</span></span><br><span class="line"><span class="keyword">let</span> &#123; e = <span class="number">4</span> &#125; = &#123;&#125;</span><br><span class="line">e <span class="comment">// 4</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> f;</span><br><span class="line">&#123; f &#125; = &#123; <span class="attr">f</span>: <span class="number">5</span> &#125; <span class="comment">// SyntaxError：syntax error</span></span><br><span class="line"><span class="comment">// JavaScript引擎会将首行的&#123;&#125;理解为代码块，因此语法错误</span></span><br><span class="line"><span class="comment">// 应写为 (&#123; f &#125; = &#123; f: 5 &#125;)</span></span><br></pre></td></tr></table></figure>
<h3 id="字符串、数字、布尔值的解构赋值"><a href="#字符串、数字、布尔值的解构赋值" class="headerlink" title="字符串、数字、布尔值的解构赋值"></a>字符串、数字、布尔值的解构赋值</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 字符串会被解构为一个类数组的对象</span></span><br><span class="line"><span class="keyword">const</span> [a, b, c, d, e] = <span class="string">'hello'</span></span><br><span class="line">a <span class="comment">// h</span></span><br><span class="line">c <span class="comment">// l</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; length &#125; = <span class="string">'hello'</span></span><br><span class="line">length <span class="comment">// 5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Number</span></span><br><span class="line"><span class="keyword">let</span> &#123; <span class="attr">toString</span>: s &#125; = <span class="number">123</span></span><br><span class="line">s === <span class="built_in">Number</span>.prototype.toString <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Boolean</span></span><br><span class="line"><span class="keyword">let</span> &#123; <span class="attr">toString</span>: s &#125; = <span class="literal">true</span></span><br><span class="line">s === <span class="built_in">Boolean</span>.prototype.toString <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Number、Boolean都有toString属性，所以变量可以取到值</span></span><br></pre></td></tr></table></figure>
<p>解构赋值的规则：若等号右边不为数组或对象，就将其转换为对象。<br>undefined、null不能转换对对象，所以不能对其解构赋值</p>
<h3 id="函数参数的解构赋值"><a href="#函数参数的解构赋值" class="headerlink" title="函数参数的解构赋值"></a>函数参数的解构赋值</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fun = <span class="function">(<span class="params">[x, y]</span>) =&gt;</span> x + y</span><br><span class="line">fun([<span class="number">1</span>, <span class="number">2</span>]) <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line">[[<span class="number">1</span>, <span class="number">2</span>], [<span class="number">3</span>, <span class="number">4</span>]].map(<span class="function">(<span class="params">[x ,y]</span>) =&gt;</span> x + y) <span class="comment">// [3, 7]</span></span><br></pre></td></tr></table></figure>
<h3 id="用途"><a href="#用途" class="headerlink" title="用途"></a>用途</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 交换变量的值</span></span><br><span class="line"><span class="keyword">let</span> x = <span class="number">1</span></span><br><span class="line"><span class="keyword">let</span> y = <span class="number">2</span></span><br><span class="line">[x, y] = [y, x]</span><br><span class="line">x <span class="comment">// 2</span></span><br><span class="line">y <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数返回多个值</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span>&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> &#123; a, b &#125; = fun()</span><br><span class="line">a <span class="comment">// 1</span></span><br><span class="line">b <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 引入模块</span></span><br><span class="line"><span class="keyword">import</span> &#123; a, b &#125; <span class="keyword">from</span> <span class="string">'mou'</span></span><br></pre></td></tr></table></figure>
<h2 id="字符串扩展"><a href="#字符串扩展" class="headerlink" title="字符串扩展"></a>字符串扩展</h2><h3 id="includes-str-num"><a href="#includes-str-num" class="headerlink" title="includes(str, num)"></a>includes(str, num)</h3><p>查找是否包含参数字符串，与indexOf()类似，但是返回布尔值。</p>
<h3 id="startsWith-str-num"><a href="#startsWith-str-num" class="headerlink" title="startsWith(str, num)"></a>startsWith(str, num)</h3><p>查找参数字符串是否在源字符串的头部。</p>
<h3 id="endsWith-str-num"><a href="#endsWith-str-num" class="headerlink" title="endsWith(str, num)"></a>endsWith(str, num)</h3><p>查找参数字符串是否在源字符串的末尾。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// includes()</span></span><br><span class="line"><span class="string">'abcdefg'</span>.includes(<span class="string">'c'</span>) <span class="comment">// true</span></span><br><span class="line"><span class="string">'abcdefg'</span>.includes(<span class="string">'c'</span>, <span class="number">2</span>) <span class="comment">// true, 第二个参数表示开始搜索的位置</span></span><br><span class="line"></span><br><span class="line"><span class="string">'abcdefg'</span>.indexOf(<span class="string">'c'</span>) <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// startsWith()</span></span><br><span class="line"><span class="string">'abcdefg'</span>.startsWith(<span class="string">'a'</span>) <span class="comment">// true</span></span><br><span class="line"><span class="string">'abcdefg'</span>.startsWith(<span class="string">'d'</span>, <span class="number">3</span>) <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// endsWith()</span></span><br><span class="line"><span class="string">'abcdefg'</span>.endsWith(<span class="string">'g'</span>) <span class="comment">// true</span></span><br><span class="line"><span class="string">'abcdefg'</span>.endsWith(<span class="string">'g'</span>, <span class="number">7</span>) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<h3 id="repeat-num"><a href="#repeat-num" class="headerlink" title="repeat(num)"></a>repeat(num)</h3><p>将源字符串重复N次，返回一个新的字符串。参数需为正整数。</p>
<h3 id="padStart-num-str"><a href="#padStart-num-str" class="headerlink" title="padStart(num, str)"></a>padStart(num, str)</h3><p>字符串头部补全，第一个参数指定字符串的最小长度，第二个参数是用来补全的字符串。</p>
<h3 id="padEnd-num-str"><a href="#padEnd-num-str" class="headerlink" title="padEnd(num, str)"></a>padEnd(num, str)</h3><p>字符串尾部补全，指定最小长度小于源字符串长度则返回源字符串。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// repeat()</span></span><br><span class="line"><span class="string">'aa'</span>.repeat(<span class="number">3</span>) <span class="comment">// ’aaaaaa'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// padStart()</span></span><br><span class="line"><span class="string">'X'</span>.padStart(<span class="number">4</span>, <span class="string">'ak'</span>) <span class="comment">// 'akakX'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// padEnd()</span></span><br><span class="line"><span class="string">'X'</span>.padEnd(<span class="number">4</span>, <span class="string">'ak'</span>) <span class="comment">// 'Xaka'</span></span><br></pre></td></tr></table></figure>
<h3 id="模板字符串"><a href="#模板字符串" class="headerlink" title="模板字符串"></a>模板字符串</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> pig = <span class="string">'pig'</span></span><br><span class="line"><span class="string">`Hello <span class="subst">$&#123; pig &#125;</span>`</span> <span class="comment">// "Hello pig"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 括号内可放入表达式</span></span><br><span class="line"><span class="string">`<span class="subst">$&#123; <span class="number">1</span> + <span class="number">2</span> &#125;</span> + <span class="subst">$&#123; <span class="number">3</span> + <span class="number">4</span> &#125;</span> = 10`</span> <span class="comment">// "3 + 7 = 10"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 可调用函数</span></span><br><span class="line"><span class="keyword">let</span> fun = <span class="function"><span class="params">()</span> =&gt;</span> <span class="string">'pig'</span></span><br><span class="line"><span class="string">`Hello <span class="subst">$&#123; fun() &#125;</span>`</span> <span class="comment">// "Hello pig"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 可以嵌套</span></span><br><span class="line"><span class="string">`xx<span class="subst">$&#123; <span class="string">`Y`</span> &#125;</span>xx`</span> <span class="comment">// "xxYxx"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 标签模板</span></span><br><span class="line">alert<span class="string">`123`</span> <span class="comment">// 123</span></span><br></pre></td></tr></table></figure>
<h2 id="Math对象扩展"><a href="#Math对象扩展" class="headerlink" title="Math对象扩展"></a>Math对象扩展</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Math.trunc() 去除一个数的小数部分</span></span><br><span class="line"><span class="built_in">Math</span>.trunc(<span class="number">1.5</span>) <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Math.sign() 判断一个数为正数、负数、0️⃣，返回1、-1、0</span></span><br><span class="line"><span class="built_in">Math</span>.sign(<span class="number">2</span>) <span class="comment">// 1</span></span><br><span class="line"><span class="built_in">Math</span>.sign(<span class="number">-2</span>) <span class="comment">// -1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ** 指数运算符</span></span><br><span class="line"><span class="number">2</span> ** <span class="number">3</span> <span class="comment">// 8 等同于 2 * 2 * 2 </span></span><br><span class="line"><span class="number">3</span> ** <span class="number">2</span> <span class="comment">// 9 等同于 3 * 3</span></span><br></pre></td></tr></table></figure>
<h2 id="函数扩展"><a href="#函数扩展" class="headerlink" title="函数扩展"></a>函数扩展</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 函数参数默认值</span></span><br><span class="line"><span class="keyword">let</span> fun = <span class="function">(<span class="params">x, y = <span class="number">1</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(x, y)</span><br><span class="line">&#125;</span><br><span class="line">fun(<span class="number">2</span>) <span class="comment">// 2, 1</span></span><br><span class="line">fun() <span class="comment">// undefined, 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数的length属性, 返回传入函数参数的个数</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>)</span>&#123;&#125;).length <span class="comment">// 2</span></span><br><span class="line"><span class="comment">// 指定默认值会导致length属性失真</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">a, b, c = <span class="number">3</span></span>)</span>&#123;&#125;).length <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// rest 参数, 返回传入函数参数的数组, rest参数后不得有其他参数。</span></span><br><span class="line"><span class="keyword">let</span> fun = <span class="function">(<span class="params">...value</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> value.sort()</span><br><span class="line">&#125;</span><br><span class="line">fun(<span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>) <span class="comment">// [1, 2, 3]</span></span><br></pre></td></tr></table></figure>
<h3 id="箭头函数"><a href="#箭头函数" class="headerlink" title="箭头函数"></a>箭头函数</h3><ul>
<li>箭头函数没有自己的this，函数内部的this就是外层代码块的this。</li>
<li>不能做为构造函数来使用，即不可使用new。</li>
<li>不存在arguments对象，可用rest参数来代替。</li>
<li>不可以使用yield命令。</li>
<li>call()、apply()、bind()方法无效</li>
</ul>
<h3 id="尾调用"><a href="#尾调用" class="headerlink" title="尾调用"></a>尾调用</h3><p>即在函数的最后一步是调用另一个函数，且后续再无任何操作。</p>
<p>函数调用后会在内存中形成一个调用记录（调用帧），保存函数调用的位置及内部变量等信息， 如果在函数A的内部调用函数B，就会在A的调用帧上方形成一个B的调用帧，等到B运行结束并将结果返回到A，A、B的调用帧才会结束，如果函数B内部还调用了函数C，以此类推，会形成一个调用栈。</p>
<p>尾调用优化，即只保留内层函数的调用帧，内层函数不使用外层函数的变量。</p>
<h3 id="尾递归"><a href="#尾递归" class="headerlink" title="尾递归"></a>尾递归</h3><p>递归，即函数调用自身，尾调用自身称为尾递归。</p>
<p>递归是非常消耗内存的，因为他们在同时生成很多很多的调用帧，很容易发生“栈溢出”的错误，但是尾递归中只存在一个调用栈，所以不会消耗过多内存，也不会发生栈溢出的错误。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 举个例子，阶乘</span></span><br><span class="line"><span class="keyword">let</span> fun = <span class="function">(<span class="params">n</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (n === <span class="number">1</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> n * fun(n - <span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line">fun(<span class="number">5</span>) <span class="comment">// 120</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 尾递归 （部分JS解释器不支持）</span></span><br><span class="line"><span class="keyword">let</span> fun = <span class="function">(<span class="params">n, total</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (n === <span class="number">1</span>) <span class="keyword">return</span> total;</span><br><span class="line">    <span class="keyword">return</span> fun(n - <span class="number">1</span>, n * total)</span><br><span class="line">&#125;</span><br><span class="line">fun(<span class="number">5</span>, <span class="number">1</span>) <span class="comment">// 120</span></span><br><span class="line">fun(<span class="number">10000</span>, <span class="number">1</span>) <span class="comment">// Infinity</span></span><br><span class="line">fun(<span class="number">100000</span>, <span class="number">1</span>) <span class="comment">// Maximum call stack size exceeded</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 正常情况下函数尾递归优化的实现，使用蹦床函数并改写原来的递归函数</span></span><br><span class="line"><span class="comment">// 蹦床函数将递归执行转换为循环执行</span></span><br><span class="line"><span class="keyword">let</span> trampoline = <span class="function">(<span class="params">f</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">while</span>(f &amp;&amp; f <span class="keyword">instanceof</span> <span class="built_in">Function</span>)&#123;</span><br><span class="line">        f = f() </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> f;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 每执行一次返回另一个函数。</span></span><br><span class="line"><span class="keyword">let</span> fun = <span class="function">(<span class="params">n, total</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (n === <span class="number">1</span>) <span class="keyword">return</span> total;</span><br><span class="line">    <span class="keyword">return</span> fun.bind(<span class="literal">null</span>, n - <span class="number">1</span>, n * total);</span><br><span class="line">&#125;</span><br><span class="line">trampoline(fun(<span class="number">10000000</span>, <span class="number">1</span>)) <span class="comment">// Infinity</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 蹦床函数并非真正的尾递归优化。</span></span><br><span class="line"><span class="keyword">let</span> tco = <span class="function">(<span class="params">f</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> value;</span><br><span class="line">    <span class="keyword">let</span> active = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">let</span> accumulated = [];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">accumulator</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        accumulated.push(<span class="built_in">arguments</span>)</span><br><span class="line">        <span class="keyword">if</span> (!active) &#123;</span><br><span class="line">            active = <span class="literal">true</span></span><br><span class="line">            <span class="keyword">while</span> (accumulated.length) &#123;</span><br><span class="line">                value = f.apply(<span class="keyword">this</span>, accumulated.shift())</span><br><span class="line">            &#125;</span><br><span class="line">            active = <span class="literal">false</span></span><br><span class="line">            <span class="keyword">return</span> value</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> fun = tco(<span class="function"><span class="keyword">function</span>(<span class="params">n, total</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (n === <span class="number">1</span>) <span class="keyword">return</span> total;</span><br><span class="line">    <span class="keyword">return</span> fun(n - <span class="number">1</span>, n * total)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">fun(<span class="number">10000000</span>, <span class="number">1</span>) <span class="comment">// Infinity</span></span><br></pre></td></tr></table></figure>
<h2 id="数组扩展"><a href="#数组扩展" class="headerlink" title="数组扩展"></a>数组扩展</h2><h3 id="扩展运算符"><a href="#扩展运算符" class="headerlink" title="扩展运算符"></a>扩展运算符</h3><p>将数组转换为逗号分隔的参数序列。任何Iterator接口的对象都可使用扩展运算符。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 主要用于函数调用</span></span><br><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="keyword">let</span> push = <span class="function">(<span class="params">arr, ...items</span>) =&gt;</span> &#123;</span><br><span class="line">    arr.push(...items)</span><br><span class="line">&#125;</span><br><span class="line">push(arr, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>) <span class="comment">// [1, 2, 3, 4, 5, 6]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 替代apply方法</span></span><br><span class="line"><span class="keyword">let</span> add = <span class="function">(<span class="params">x, y</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line">&#125;</span><br><span class="line">add.apply(<span class="literal">null</span>, arr) <span class="comment">// 3</span></span><br><span class="line">add(...arr) <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 合并数组</span></span><br><span class="line"><span class="keyword">let</span> arr = [<span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>].concat(arr) <span class="comment">// ES5</span></span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, ...arr]  <span class="comment">//ES6</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 结合解构赋值,只能放在参数的最有一位。</span></span><br><span class="line">[first, ...rest] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line">fist <span class="comment">// 1</span></span><br><span class="line">rest <span class="comment">// [2, 3, 4]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 将字符串转为数组</span></span><br><span class="line">[...<span class="string">'hello'</span>] <span class="comment">// ["h", "e", "l", "l", "o"]</span></span><br></pre></td></tr></table></figure></p>
<h3 id="Array方法"><a href="#Array方法" class="headerlink" title="Array方法"></a>Array方法</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Array.from(obj，fun) 将类数组或可遍历对象转换为数组</span></span><br><span class="line"><span class="keyword">let</span> arr = &#123;</span><br><span class="line">    <span class="string">'0'</span>: <span class="string">'a'</span>,</span><br><span class="line">    <span class="string">'1'</span>: <span class="string">'b'</span>,</span><br><span class="line">    <span class="string">'2'</span>: <span class="string">'c'</span>,</span><br><span class="line">    length: <span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ES6</span></span><br><span class="line"><span class="built_in">Array</span>.from(arr) <span class="comment">// ["a", "b", "c"]</span></span><br><span class="line"><span class="comment">// ES5</span></span><br><span class="line">[].slice.call(arr) <span class="comment">// ["a", "b", "c"]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 第二个参数类似map方法。</span></span><br><span class="line"><span class="built_in">Array</span>.from(arr, (i) =&gt; i + <span class="string">'x'</span>) <span class="comment">// ["ax", "bx", "cx"]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Array.of() 将一组值转换为数组</span></span><br><span class="line"><span class="built_in">Array</span>.of(<span class="number">1</span>, <span class="number">2</span>) <span class="comment">// [1, 2]</span></span><br></pre></td></tr></table></figure>
<h3 id="数组实例方法"><a href="#数组实例方法" class="headerlink" title="数组实例方法"></a>数组实例方法</h3><p>Array.protorype</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// copyWithin(target, start, end) 将指定的数组成员复制到其它位置（覆盖原有成员），返回该数组</span></span><br><span class="line"><span class="comment">// target: 从该位置开始替换数据</span></span><br><span class="line"><span class="comment">// start: 从该位置开始读取数据，默认0</span></span><br><span class="line"><span class="comment">// end: 到该位置停止读取数据，默认数组长度</span></span><br><span class="line">arr.copyWithin(<span class="number">3</span>) <span class="comment">// [1, 2, 3, 1, 2, 3]</span></span><br><span class="line">arr.copyWithin(<span class="number">1</span>, <span class="number">2</span>) <span class="comment">// [1, 3, 4, 5, 6, 6]</span></span><br><span class="line">arr.copyWithin(<span class="number">3</span>, <span class="number">0</span>, <span class="number">3</span>) <span class="comment">// [1, 2, 3, 1, 2, 3]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// find() 查找符合条件的成员，无则返回undefined</span></span><br><span class="line">arr.find(<span class="function"><span class="params">i</span> =&gt;</span> i &lt; <span class="number">0</span>) <span class="comment">// undefined</span></span><br><span class="line">arr.find(<span class="function"><span class="params">i</span> =&gt;</span> i &gt; <span class="number">3</span>) <span class="comment">// 4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// findIndex(val, index, arr) 查找符合条件的成员，返回其位置,无则返回-1</span></span><br><span class="line">arr.findIndex(<span class="function">(<span class="params">val</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> val &gt; <span class="number">3</span> <span class="comment">// 3</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// fill(val, start, end) 使用给定的值填充数组</span></span><br><span class="line">arr.fill(<span class="string">'x'</span>) <span class="comment">// ["x", "x", "x", "x", "x", "x"]</span></span><br><span class="line">arr.fill(<span class="string">'x'</span>, <span class="number">4</span>) <span class="comment">// [1, 2, 3, 4, "x", "x"]</span></span><br><span class="line">arr.fill(<span class="string">'x'</span>, <span class="number">2</span>, <span class="number">4</span>) <span class="comment">// [1, 2, "x", "x", 5, 6]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// includes() 类似indexOf()，返回boolean</span></span><br><span class="line">arr.includes(<span class="number">1</span>) <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// in运算符 判断指定的属性是否在原型链中，返回boolean</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">in</span> arr <span class="comment">// true</span></span><br><span class="line">length <span class="keyword">in</span> arr <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 数组空位, 表示该位置没有任何值。</span></span><br><span class="line"><span class="comment">// ES5会忽略空位，ES6会将空位转换为undefined</span></span><br><span class="line"><span class="keyword">let</span> empty = [ , , , ]</span><br><span class="line"><span class="number">0</span> <span class="keyword">in</span> empty <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<h2 id="对象扩展"><a href="#对象扩展" class="headerlink" title="对象扩展"></a>对象扩展</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ES6中，对象的属性名和属性值相同时可以不写属性值。</span></span><br><span class="line"><span class="keyword">let</span> a = <span class="string">'b'</span></span><br><span class="line"><span class="keyword">let</span> obj = &#123; a &#125;</span><br><span class="line">a <span class="comment">// &#123; a: 'b' &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ES5写法</span></span><br><span class="line"><span class="keyword">let</span> foo = &#123;</span><br><span class="line">    <span class="string">'class'</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; &#125; <span class="comment">// class为关键字，加引号防止解析错误 </span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ES6写法</span></span><br><span class="line"><span class="keyword">let</span> foo = &#123;</span><br><span class="line">    <span class="class"><span class="keyword">class</span>() </span>&#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 属性名表达式</span></span><br><span class="line">obj[<span class="string">'j'</span> + <span class="string">'x'</span> + <span class="string">'r'</span>] = <span class="number">315</span></span><br><span class="line">obj.jxr <span class="comment">// 315</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Object.is() 判断两个值是否完全相等，行为与’===‘一致</span></span><br><span class="line"><span class="built_in">Object</span>.is(&#123;&#125;, &#123;&#125;) <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<h3 id="Object-assign-target-source"><a href="#Object-assign-target-source" class="headerlink" title="Object.assign(target, source)"></a>Object.assign(target, source)</h3><p>将一个或多个源对象所有可枚举属性复制到目标对象, 实现合并对象（浅拷贝），若有同名属性，后者则会覆盖前者。</p>
<p>Object.assign()只复制一个属性的值，而不会复制它的赋值方法个取值方法。</p>
<p>浅拷贝：将原对象的引用直接赋给新对象，新对象只是原对象的一个引用。改变<br>新对象的属性值时，原对象的值也会被改变。<br>深拷贝：创建一个全新的对象，其值不是引用，改变原对象属性值时不会影响到新对象。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = &#123;</span><br><span class="line">        a: <span class="number">0</span>,</span><br><span class="line">        b: &#123;</span><br><span class="line">            c: <span class="number">0</span>,</span><br><span class="line">            d: <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">let</span> b = <span class="built_in">Object</span>.assign(&#123;&#125;, a)</span><br><span class="line"><span class="built_in">JSON</span>.stringify(b) <span class="comment">// "&#123;"a":0,"b":&#123;"c":0,"d":0&#125;&#125;" </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 浅拷贝</span></span><br><span class="line">a.b.c = <span class="number">1</span></span><br><span class="line"><span class="built_in">JSON</span>.stringify(a) <span class="comment">// "&#123; "a": 0, "b": &#123; "c": 1, "d": 0 &#125; &#125;"</span></span><br><span class="line"><span class="built_in">JSON</span>.stringify(b) <span class="comment">// "&#123; "a": 0, "b": &#123; "c": 1, "d": 0 &#125; &#125;"</span></span><br><span class="line"></span><br><span class="line">b.b.d = <span class="number">2</span></span><br><span class="line"><span class="built_in">JSON</span>.stringify(a) <span class="comment">// "&#123; "a": 0, "b": &#123; "c": 1, "d": 2 &#125; &#125;"</span></span><br><span class="line"><span class="built_in">JSON</span>.stringify(b) <span class="comment">// "&#123; "a": 0, "b": &#123; "c": 1, "d": 2 &#125; &#125;"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 扩展运算符实现浅拷贝</span></span><br><span class="line"><span class="keyword">let</span> d = &#123; <span class="attr">e</span>: <span class="number">1</span>, ...a &#125;</span><br><span class="line">d <span class="comment">// "&#123; "e": 1, "a": 0, "b": &#123; "c": 0, "d": 0 &#125; &#125;"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 深拷贝</span></span><br><span class="line"><span class="keyword">let</span> c = <span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(a))</span><br><span class="line">a.b.c = <span class="number">1</span></span><br><span class="line"><span class="built_in">JSON</span>.stringify(a) <span class="comment">// "&#123; "a": 0, "b": &#123; "c": 1, "d": 0 &#125; &#125;"</span></span><br><span class="line"><span class="built_in">JSON</span>.stringify(c) <span class="comment">// "&#123; "a": 0, "b": &#123; "c": 0, "d": 0 &#125; &#125;"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 为对象添加方法</span></span><br><span class="line"><span class="built_in">Object</span>.assign(example.prototype, &#123;</span><br><span class="line">    method() &#123;&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">example.prototype.method = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"><span class="comment">// 以上两中写法等同。</span></span><br></pre></td></tr></table></figure></p>
<h3 id="Object-setPrototypeOf-、Object-getPrototypeOf"><a href="#Object-setPrototypeOf-、Object-getPrototypeOf" class="headerlink" title="Object.setPrototypeOf()、Object.getPrototypeOf()"></a>Object.setPrototypeOf()、Object.getPrototypeOf()</h3><p>Object.setPrototypeOf(obj, prototype): 将指定的对象的原型设置为另一个对象或null</p>
<p>Object.getPrototypeOf(obj): 返回指定对象的原型</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> proto = &#123;&#125;</span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">        a: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.setPrototypeOf(obj, proto)</span><br><span class="line">proto.b = <span class="number">1</span></span><br><span class="line">obj.b <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.getPrototypeOf(obj) <span class="comment">// &#123; b: 1 &#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="Null传导运算符-提案"><a href="#Null传导运算符-提案" class="headerlink" title="Null传导运算符 (提案)"></a>Null传导运算符 (提案)</h3><p>在开发过程中我们往往会遇到需要判断某个对象的内部属性是否存在。比如要读取data.results.product, 安全的写法如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> product = (data &amp;&amp; data.results &amp;&amp; data.results.product) || <span class="string">'default'</span></span><br></pre></td></tr></table></figure>
<p>这样的写法虽然解决了data 或 data.results 不存在而导致的报错，但是这样的层层判断是非常麻烦的。Null传导运算符可以简化上面的写法。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> product = data?.results?.product) || <span class="string">'default'</span></span><br><span class="line"></span><br><span class="line">fun?.(...arg) <span class="comment">// 函数调用方法</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> C?.(...arg) <span class="comment">// 构造函数调用</span></span><br></pre></td></tr></table></figure>
<h3 id="遍历操作"><a href="#遍历操作" class="headerlink" title="遍历操作"></a>遍历操作</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">        a: <span class="number">1</span>,</span><br><span class="line">        b: <span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment">// for...in</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i <span class="keyword">in</span> obj) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(i)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// a</span></span><br><span class="line"><span class="comment">// b</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Object.keys() 返回数组，包含对象自身的所有属性，不含Symbol</span></span><br><span class="line"><span class="built_in">Object</span>.keys(obj) <span class="comment">// ["a", "b"]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Object.values() 返回数组，包含对象自身所有的属性值。</span></span><br><span class="line"><span class="built_in">Object</span>.values(obj) <span class="comment">// [1, 2]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Object.entries()  返回二维数组，成员是键值对数组。</span></span><br><span class="line"><span class="built_in">Object</span>.entries(obj) <span class="comment">// [["a", 1], ["b", 2]]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Object.getOwnPropertyNames(obj) 返回数组, 包含对象自身所有属性，不包含Symbol和不可枚举属性</span></span><br><span class="line"><span class="built_in">Object</span>.getOwnPropertyNames(obj) <span class="comment">// ["a", "b"]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Object.getOwnPropertySymbols(symbols) 返回自身所有Symbol属性</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Reflect.ownKeys(obj) 返回所有属性。everything~</span></span><br></pre></td></tr></table></figure>
<h2 id="Set、Map数据结构"><a href="#Set、Map数据结构" class="headerlink" title="Set、Map数据结构"></a>Set、Map数据结构</h2><h3 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h3><p>类似数组，但是成员唯一，没有重复。本身是构造函数，用来生成set数据解构。</p>
<p>Set实例内部，使用类似于“===“来判断两个值是否相同。</p>
<p>两个NaN是不相等的，但在Set实例内部，两个NaN相等。</p>
<h4 id="实例属性及方法"><a href="#实例属性及方法" class="headerlink" title="实例属性及方法"></a>实例属性及方法</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数组去重，将Set结构转换为数组。</span></span><br><span class="line"><span class="keyword">let</span> s = <span class="keyword">new</span> <span class="built_in">Set</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">4</span>])</span><br><span class="line">[...s] <span class="comment">// [1, 2, 3, 4]</span></span><br><span class="line"><span class="built_in">Array</span>.from(s) <span class="comment">// [1, 2, 3, 4]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// size 返回Set实例的成员总数</span></span><br><span class="line">s.size <span class="comment">// 4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// add(val) 添加成员，返回添加后的结构</span></span><br><span class="line">s.add(<span class="number">5</span>) <span class="comment">// Set(5) &#123;1, 2, 3, 4, 5&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// delete(val) 删除成员，返回boolean</span></span><br><span class="line">s.delete(<span class="number">1</span>) <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// has(val) 返回boolean，是否包含成员</span></span><br><span class="line">s.has(<span class="number">2</span>) <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 清除成员，无返回值</span></span><br><span class="line">s.clear() <span class="comment">//</span></span><br></pre></td></tr></table></figure>
<h4 id="遍历操作-1"><a href="#遍历操作-1" class="headerlink" title="遍历操作"></a>遍历操作</h4><p>Set遍历的顺序就是插入的顺序。</p>
<h5 id="keys-、values"><a href="#keys-、values" class="headerlink" title="keys()、values()"></a>keys()、values()</h5><p>方法返回遍历器对象，由于Set数据结构键值键名相同，所以这两个方法的行为是完全一致的。</p>
<h5 id="entries"><a href="#entries" class="headerlink" title="entries()"></a>entries()</h5><p>方法返回遍历器对象，同时包括键名和键值。</p>
<h5 id="forEach"><a href="#forEach" class="headerlink" title="forEach()"></a>forEach()</h5><p>无返回值，参数为处理函数，对每个成员执行操作。该处理函数的参数为键值、键名、集合本身。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// keys()</span></span><br><span class="line"><span class="keyword">let</span> s = <span class="keyword">new</span> <span class="built_in">Set</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i <span class="keyword">of</span> s.keys())&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(i)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 1</span></span><br><span class="line"><span class="comment">// 2</span></span><br><span class="line"><span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// values()</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i <span class="keyword">of</span> s))&#123; <span class="comment">// 可省略values方法</span></span><br><span class="line">    <span class="built_in">console</span>.log(i)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 1</span></span><br><span class="line"><span class="comment">// 2</span></span><br><span class="line"><span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// entries()</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i <span class="keyword">of</span> s.entries())&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(i)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// [1, 1]</span></span><br><span class="line"><span class="comment">// [2, 2]</span></span><br><span class="line"><span class="comment">// [3, 3]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// forEach()</span></span><br><span class="line">s.forEach(<span class="function">(<span class="params">values, keys, others</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(values, keys, others)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 1 1 Set(3) &#123;1, 2, 3&#125;</span></span><br><span class="line"><span class="comment">// 2 2 Set(3) &#123;1, 2, 3&#125;</span></span><br><span class="line"><span class="comment">// 3 3 Set(3) &#123;1, 2, 3&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="Set实现交集、并集、差集"><a href="#Set实现交集、并集、差集" class="headerlink" title="Set实现交集、并集、差集"></a>Set实现交集、并集、差集</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> <span class="built_in">Set</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line"><span class="keyword">let</span> b = <span class="keyword">new</span> <span class="built_in">Set</span>([<span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> union = <span class="keyword">new</span> <span class="built_in">Set</span>([...a, ...b])</span><br><span class="line">union <span class="comment">// 交集 Set(4) &#123;1, 2, 3, 4&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> intersect = <span class="keyword">new</span> <span class="built_in">Set</span>([...a].filter(<span class="function"><span class="params">x</span> =&gt;</span> b.has(x)))</span><br><span class="line">intersect <span class="comment">// 并集 Set(2) &#123;2, 3&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> difference = <span class="keyword">new</span> <span class="built_in">Set</span>([...a].filter(<span class="function"><span class="params">x</span> =&gt;</span> !b.has(x)))</span><br><span class="line">difference <span class="comment">// 差集 Set(1) &#123;1&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="WeakSet"><a href="#WeakSet" class="headerlink" title="WeakSet"></a>WeakSet</h3><p>与Set结构类似，也是不重复的值的集合，但与Set有两个区别</p>
<ul>
<li>WeakSet成员只能是对象。</li>
<li>WeakSet中的对象都是弱引用，垃圾回收机制不考虑WeakSet对该对象的应用，不会因此而应发内存泄露。</li>
</ul>
<p>WeakSet适合临时存放一组对象，以及和对象绑定的信息，只要对象在外部小时，它在WeakSet中的应用就会自动消失。</p>
<p>任何具有iterable(可迭代的)接口的对象都可以作为WeakSet的参数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ws = <span class="keyword">new</span> <span class="built_in">WeakSet</span>([[<span class="number">1</span>, <span class="number">2</span>], [<span class="number">3</span>, <span class="number">4</span>]])</span><br><span class="line">ws <span class="comment">// WeakSet &#123; [1, 2], [3, 4] &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 向实例添加成员</span></span><br><span class="line"><span class="keyword">const</span> obj = &#123;&#125;</span><br><span class="line">ws.add(obj) <span class="comment">// WeakSet &#123; &#123;&#125; &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 某个值是否在实例中</span></span><br><span class="line">ws.has(obj) <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 清除实例指定成员</span></span><br><span class="line">ws.delete(obj) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>可用于储存DOM节点，不用担心节点从文档中移除时引发的内存泄露。</p>
<h3 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h3><p>JavaScript的对象（Object）本质上是键值对的集合，但是只接受字符串作为键。<br>Map数据结构类似于Object也是键值对的集合，但键可以是各种类型的值。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Map构造函数接受一个二维数组作为参数.</span></span><br><span class="line"><span class="keyword">let</span> m = <span class="keyword">new</span> <span class="built_in">Map</span>([[<span class="number">1</span>, <span class="number">2</span>], [<span class="number">3</span>, <span class="number">4</span>], [<span class="number">5</span>, <span class="number">6</span>]])</span><br><span class="line"><span class="comment">// Map(3) &#123;1 =&gt; 2, 3 =&gt; 4, 5 =&gt; 6&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 也可接受双元素数组的Set、Map对象用来生成新的Map数据结构。</span></span><br><span class="line"><span class="keyword">let</span> s = <span class="keyword">new</span> <span class="built_in">Set</span>([[<span class="number">1</span>, <span class="number">2</span>], [<span class="number">3</span>, <span class="number">4</span>], [<span class="number">5</span>, <span class="number">6</span>]])</span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Map</span>(s) <span class="comment">// Map(3) &#123;1 =&gt; 2, 3 =&gt; 4, 5 =&gt; 6&#125;</span></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Map</span>(m) <span class="comment">// Map(3) &#123;1 =&gt; 2, 3 =&gt; 4, 5 =&gt; 6&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Map的键实际上是与内存地址绑定，内存地址不同则视为两个键。</span></span><br><span class="line"><span class="keyword">let</span> a = [<span class="string">'a'</span>]</span><br><span class="line"><span class="keyword">let</span> b = [<span class="string">'a'</span>]</span><br><span class="line"><span class="keyword">let</span> m = <span class="keyword">new</span> <span class="built_in">Map</span>()</span><br><span class="line"></span><br><span class="line">m.set(a, <span class="number">1</span>)</span><br><span class="line">m.set(b, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">m.get(a) <span class="comment">// 1</span></span><br><span class="line">m.get(b) <span class="comment">// 2</span></span><br><span class="line">m.get([<span class="string">'a'</span>]) <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure>
<h4 id="实例属性及方法-1"><a href="#实例属性及方法-1" class="headerlink" title="实例属性及方法"></a>实例属性及方法</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> m = <span class="keyword">new</span> <span class="built_in">Map</span>([[<span class="number">1</span>, <span class="number">2</span>], [<span class="number">3</span>, <span class="number">4</span>]])</span><br><span class="line"></span><br><span class="line"><span class="comment">// size 返回Map结构的成员个数</span></span><br><span class="line">m.size <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// set(key, val) 设置键值，若存在则覆盖，返回整个Map结构</span></span><br><span class="line">m.set(<span class="number">5</span>, <span class="number">6</span>) <span class="comment">// Map(3) &#123;1 =&gt; 2, 3 =&gt; 4, 5 =&gt; 6&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// get(key) 返回对应的值，无则返回undefined</span></span><br><span class="line">m.get(<span class="number">3</span>) <span class="comment">// 4</span></span><br><span class="line">m.get(<span class="number">7</span>) <span class="comment">// undefined</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// has(key) 查找键名，返回boolean</span></span><br><span class="line">m.has(<span class="number">1</span>) <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// delete() 删除键值，返回boolean</span></span><br><span class="line">m.delete(<span class="number">1</span>) <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// clear() 清空数据结构，无返回值。</span></span><br></pre></td></tr></table></figure>
<h4 id="遍历方法"><a href="#遍历方法" class="headerlink" title="遍历方法"></a>遍历方法</h4><p>keys(): 返回键名<br>values(): 返回键值<br>entries(): 返回所有成员<br>forEach(): 遍历所有成员</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> m = <span class="keyword">new</span> <span class="built_in">Map</span>([[<span class="string">'a'</span>, <span class="number">1</span>], [<span class="string">'b'</span>, <span class="number">2</span>]])</span><br><span class="line"></span><br><span class="line"><span class="comment">// keys()</span></span><br><span class="line">[...m.keys()] <span class="comment">// ["a", "b"]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// values()</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> value <span class="keyword">of</span> m.values()) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(value)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 1</span></span><br><span class="line"><span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// entries()</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> entries <span class="keyword">of</span> m.entries()) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(entries)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ["a", 1]</span></span><br><span class="line"><span class="comment">// ["b", 2]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// forEach(value, key)</span></span><br><span class="line">m.forEach(<span class="function">(<span class="params">value, key</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(key, value)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// a 1</span></span><br><span class="line"><span class="comment">// b 2</span></span><br></pre></td></tr></table></figure>
<h3 id="WeakMap"><a href="#WeakMap" class="headerlink" title="WeakMap"></a>WeakMap</h3><ul>
<li>只接受对象作为键名(除了null)。</li>
<li>键名所指向的对象不计入垃圾回收机制。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// methods</span></span><br><span class="line"><span class="keyword">let</span> wm = <span class="keyword">new</span> <span class="built_in">WeakMap</span>()</span><br><span class="line"></span><br><span class="line">wm.set()</span><br><span class="line">wm.get()</span><br><span class="line">wm.has()</span><br><span class="line">wm.delete()</span><br><span class="line"></span><br><span class="line"><span class="comment">// example</span></span><br><span class="line"><span class="keyword">let</span> e1 = <span class="built_in">document</span>.getElementById(<span class="string">'a'</span>)</span><br><span class="line"><span class="keyword">let</span> e2 = <span class="built_in">document</span>.getElementById(<span class="string">'b'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> arr = [[e1, <span class="string">'a'</span>], [e2, <span class="string">'b'</span>]]</span><br><span class="line"><span class="comment">// 一旦不需要使用e1、e2这两个对象的时候，需要将其手动删除，否则会造成内存泄露。垃圾回收机制不会释放其所占用的内存。</span></span><br><span class="line">arr[<span class="number">0</span>] = <span class="literal">null</span></span><br><span class="line">arr[<span class="number">1</span>] = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 当需要向对象中添加数据又不想干扰垃圾回收机制时，即可使用WeakMap</span></span><br><span class="line"><span class="keyword">let</span> wm = <span class="keyword">new</span> <span class="built_in">WeakMap</span>()</span><br><span class="line"><span class="keyword">let</span> ele = <span class="built_in">document</span>.getElementById(<span class="string">'c'</span>)</span><br><span class="line"></span><br><span class="line">wm.set(ele, <span class="string">'c'</span>)</span><br><span class="line">wm.get(ele) <span class="comment">// 'c'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// WeakMap弱引用的只是键名，键值正常引用，及时WeakMap外部消除了对象，WeakMap内部依然存在</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> key = &#123;&#125;</span><br><span class="line"><span class="keyword">let</span> obj = &#123; <span class="attr">obj</span>: <span class="number">1</span> &#125;</span><br><span class="line">wm.set(key, obj)</span><br><span class="line">obj = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">ws.get(key) <span class="comment">// &#123;obj: 1&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="垃圾回收机制"><a href="#垃圾回收机制" class="headerlink" title="垃圾回收机制"></a>垃圾回收机制</h3><blockquote>
<p>基本类型的值保存在栈内存中。<br>引用类型的值保存在堆内存中，会在栈中保存一个指向该对象的指针。</p>
</blockquote>
<p>计算机分配给浏览器的可用内存是有限制的，为了防止运行了JavaScript的页面耗尽系统内存而导致系统崩溃，执行环境会负责管理代码执行过程中使用的内存。垃圾收集器是周期性运行的，找到那些不再使用的变量打上标记然后释放其占用的内存。<br>标识无用变量的方式有两种：</p>
<ul>
<li><p>标记清除<br>  垃圾收集器在运行的时候会给储存在内存中的所有变量都加上标记，然后会去掉环境中的变量以及被环境中的变量引用的变量的标记。在此之后，如果变量再次被加上标记，则被视为准备删除的变量，原因是环境中的变量已经无法访问到这些变量了。最后垃圾收集器将销毁那些带标记的值并收回其占用的内存空间。</p>
</li>
<li><p>引用计数<br>  跟踪记录每个值的引用次数。<br>  循环引用会导致大量内存泄露。</p>
</li>
</ul>
<p><strong>一旦变量不再使用，最好将其值设为null来解除引用。</strong></p>
<h2 id="Symbol"><a href="#Symbol" class="headerlink" title="Symbol"></a>Symbol</h2><p>ES5中对象属性名都是字符串，容易造成属性名冲突，Symbol表示独一无二的值，是一种新的原始数据类型。Symbol函数接收一个字符串作为参数，仅用于对当前Symbol值的描述。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> s = <span class="built_in">Symbol</span>()</span><br><span class="line">s <span class="comment">// Symbol()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> s1 = <span class="built_in">Symbol</span>(<span class="string">'sym'</span>)</span><br><span class="line"><span class="keyword">const</span> s2 = <span class="built_in">Symbol</span>(<span class="string">'sym'</span>)</span><br><span class="line"></span><br><span class="line">s1 == s2 <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj = &#123;&#125;</span><br><span class="line">obj[s1] = <span class="string">'hello'</span></span><br><span class="line">obj <span class="comment">// &#123; Symbol(sym): "hello" &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 在对象内部使用Symbol值定义属性名时必须放在方括号内</span></span><br><span class="line"><span class="keyword">const</span> fun = <span class="built_in">Symbol</span>(<span class="string">'fun'</span>)</span><br><span class="line"><span class="keyword">let</span> obj2 = &#123;</span><br><span class="line">    [s2]: <span class="string">'hello'</span>,</span><br><span class="line">    [fun]: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">obj2 <span class="comment">// &#123; Symbol(sym): "hello", Symbol(fun): ƒ &#125;</span></span><br><span class="line"><span class="comment">// 可简写为 [fun]() &#123;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用Symbol作为属性名，使用常规的遍历方法无法获取Symbol属性名，需要使用Object.getOwnPropertySymbols(),该方法返回一个数组，成员是Symbol属性名的Symbol值。</span></span><br><span class="line"><span class="built_in">Object</span>.keys(obj2) <span class="comment">// []</span></span><br><span class="line"><span class="built_in">Object</span>.getOwnPropertySymbols(obj2) <span class="comment">// [Symbol(sym), Symbol(fun)]</span></span><br></pre></td></tr></table></figure>
<h3 id="Symbol方法"><a href="#Symbol方法" class="headerlink" title="Symbol方法"></a>Symbol方法</h3><h4 id="Symbol-for-、Symbol-keyFor"><a href="#Symbol-for-、Symbol-keyFor" class="headerlink" title="Symbol.for()、Symbol.keyFor()"></a>Symbol.for()、Symbol.keyFor()</h4><p>Symbol.for()接收一个字符串作为参数，然后搜索有没有以该字符串为名称的Symbol值，如果有则返回，无则新建一个并返回。</p>
<p>Symbol.for()会登记在<strong>全局环境中</strong>供搜索,可以再不同的iframe中取到，循环30次Symbol.for()都会返回同一个值，Symbol()则不会登记，会返回30个不同的值。</p>
<p>Symbol.keyFor()会返回一个已登记的Symbol类型值的key。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s1 = <span class="built_in">Symbol</span>.for(<span class="string">'sym'</span>)</span><br><span class="line"><span class="keyword">let</span> s2 = <span class="built_in">Symbol</span>.for(<span class="string">'sym'</span>)</span><br><span class="line"><span class="keyword">let</span> s3 = <span class="built_in">Symbol</span>(<span class="string">'sym'</span>)</span><br><span class="line">s1 === s2 <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Symbol</span>.keyFor(s2) <span class="comment">// 'sym'</span></span><br><span class="line"><span class="built_in">Symbol</span>.keyFor(s3) <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure>
<h4 id="Symbol-hasInstance"><a href="#Symbol-hasInstance" class="headerlink" title="Symbol.hasInstance()"></a>Symbol.hasInstance()</h4><p>指向一个内部方法,对象在使用instanceof时会调用该方法，判断该对象是否为某个构造函数的实例。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Myclass</span> </span>&#123;</span><br><span class="line">    [<span class="built_in">Symbol</span>.hasInstance](foo) &#123;</span><br><span class="line">        reutrn foo <span class="keyword">instanceof</span> <span class="built_in">Array</span>;    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>] <span class="keyword">instanceof</span> <span class="keyword">new</span> Myclass() <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<h4 id="Symbol-match"><a href="#Symbol-match" class="headerlink" title="Symbol.match()"></a>Symbol.match()</h4><p>在使用String.prototype.startWith()、String.prototype.endWith()、String.prototype.includes()这类方法时，会检查其第一个参数是否为正则表达式，如果是正则表达式则会抛出错误。</p>
<p>将Symbol.match 置为 false 时则不会检查是否为正则表达式。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> reg = <span class="regexp">/foo/</span></span><br><span class="line"></span><br><span class="line"><span class="string">'/foo/'</span>.includes(reg) <span class="comment">// First argument to String.prototype.includes must not be a regular expression</span></span><br><span class="line"></span><br><span class="line">reg[<span class="built_in">Symbol</span>.match] = <span class="literal">false</span></span><br><span class="line"><span class="string">'/foo/'</span>.includes(reg)</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/06/attitude/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr.J">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/logo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hey">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/06/attitude/" class="post-title-link" itemprop="url">谨记！</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-07-06 22:42:44" itemprop="dateCreated datePublished" datetime="2019-07-06T22:42:44+00:00">2019-07-06</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2020-06-06 09:36:31" itemprop="dateModified" datetime="2020-06-06T09:36:31+00:00">2020-06-06</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/I-want-to-say/" itemprop="url" rel="index"><span itemprop="name">I want to say</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2019/07/06/attitude/" class="leancloud_visitors" data-flag-title="谨记！">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">Views: </span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>敬畏线上变更的每一行代码‼️<br>做到三问：</p>
<ol>
<li>为什么要修改</li>
<li>此次修改是否为最优</li>
<li>修改后会对线上有什么影响</li>
</ol>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/06/12/http/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr.J">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/logo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hey">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/06/12/http/" class="post-title-link" itemprop="url">HTTP 超文本运输协议（HyperText Transfer Protocol）</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-06-12 22:47:39" itemprop="dateCreated datePublished" datetime="2019-06-12T22:47:39+00:00">2019-06-12</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2020-06-06 09:36:31" itemprop="dateModified" datetime="2020-06-06T09:36:31+00:00">2020-06-06</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/TCP-IP/" itemprop="url" rel="index"><span itemprop="name">TCP/IP</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2019/06/12/http/" class="leancloud_visitors" data-flag-title="HTTP 超文本运输协议（HyperText Transfer Protocol）">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">Views: </span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>用于客户端和服务端请求和响应超文本信息，请求访问资源的一端称之为客户端，响应返回资源的一端称之为服务端且都是通信过程中的应用进程。属于TCP/IP协议族的子集，处于TCP/IP五层网络模型的应用层。</strong></p>
<p><strong>请求报文是由请求方法、请求URI、协议版本、可选的请求首部字段和内容实体组成。</strong></p>
<h2 id="URI、URL、URN的区别"><a href="#URI、URL、URN的区别" class="headerlink" title="URI、URL、URN的区别"></a>URI、URL、URN的区别</h2><ul>
<li>URI（Uniform Resource Identifier，统一资源标识符)</li>
<li>URL (Uniform Resource Locator，统一资源定位符</li>
<li>URN（Uniform Resource Name，统一资源名称）</li>
</ul>
<p><img src="https://ruixiaojia-blog.oss-cn-hangzhou.aliyuncs.com/blog/http/uri.png?x-oss-process=style/compression" alt="uri"></p>
<h3 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h3><p><img src="https://ruixiaojia-blog.oss-cn-hangzhou.aliyuncs.com/blog/http/url.png?x-oss-process=style/compression" alt="url"></p>
<ul>
<li>protocol 协议部分 : 代表该网页使用的是HTTP协议，”//“为分隔符</li>
<li>userinfo 用户信息 : 用于填写一些用户相关的信息，比如可能会填写”user:password”(不建议用于填写用户名及密码)</li>
<li>host 域名部分 : 也可以使用IP地址作为域名使用</li>
<li>port 端口部分 : 域名和端口之间使用“:”作为分隔符。端口不是一个URL必须的部分，如果省略端口部分，将采用默认端口80</li>
<li>path 虚拟目录 : 定位主机上的具体文件位置。</li>
<li>query 查询字符串 : 为请求提供参数，用&amp;连接的key=value键值对</li>
<li>fragment 位置标示 : 请求中不需要</li>
</ul>
<h2 id="TCP-IP五层网络模型"><a href="#TCP-IP五层网络模型" class="headerlink" title="TCP/IP五层网络模型"></a>TCP/IP五层网络模型</h2><p><strong> * 本文只对TCP/IP网络模型作简单说明，网络连接中的具体过程待我二刷《计算机网络》后详细讲解。</strong></p>
<table>
<thead>
<tr>
<th>TCP/IP网络模型</th>
<th>协议</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>应用层</td>
<td>DNS、HTTP、FTP、SMTP、SNMP</td>
<td>决定了向用户提供应用服务时的通信活动</td>
</tr>
<tr>
<td>运输层</td>
<td>TCP、UDP（建立连接、数据传送、连接释放）</td>
<td>向应用层提供通信服务，属于面向通信部分的最高层，面向用户的最低层</td>
</tr>
<tr>
<td>网络层</td>
<td>IP（ARP、ICMP、IGMP）、路由（RIP、OSPF）IPv4、IPv6、VPN</td>
<td>向上层只提供简单灵活、无链接、尽最大努力交付的数据服务</td>
</tr>
<tr>
<td>数据链路层</td>
<td>PPP、CSMA/CD、点对点信道、广播信道</td>
<td>将网络层交下来的数据构成<strong>帧</strong>发送到链路上，以及把接收到的<strong>帧</strong>取出交给网络层</td>
</tr>
<tr>
<td>物理层</td>
<td>信道（单工、半双工、全双工）</td>
<td>在计算机的传输媒体上传输比特流，确定与传输媒体的接口特性</td>
</tr>
<tr>
<td>物理介质</td>
<td>双绞线、光纤、同轴电缆</td>
<td>光信号或电信号</td>
</tr>
</tbody>
</table>
<p><img src="https://ruixiaojia-blog.oss-cn-hangzhou.aliyuncs.com/blog/http/tcp%3Aip.png?x-oss-process=style/compression" alt="tcp/ip"></p>
<p><strong>客户端在发送数据时，每经过一层都会打上一个该层所属的首部信息，反之，服务端在接收数据时，每经过一层会取消对等层的首部信息。</strong></p>
<p>这一复杂的过程对用户来说是透明的，就好像客户端直接将信息发送给了服务端的应用进程。同理，任何两个对等层之间也像虚线那样把数据直接传递给对方。</p>
<ul>
<li><strong>协议是“水平的”</strong>，即控制对等层实体之间通信的规则。</li>
<li><strong>服务是“垂直的”</strong>，即服务是由下层向上层通过接口提供的。</li>
</ul>
<blockquote>
<p>类似于生活中收发快递，为了确保你所寄出去的邮件不会在运输的过程中损坏或被更换内容，你需要加上一层包装并在包装上做上记号，快递公司在运输之前也会加上一层包装并且填写上对应的地址，以防止运输过程中出现损坏或丢失，在快递运输的过程中经过哪些中转站由哪些快递员处理则是不需要知道的，收件方只需要在收到快递后需要确保包装完好、标记准确则可以确认收到的东西为正确的。</p>
</blockquote>
<h2 id="HTTP请求的方法"><a href="#HTTP请求的方法" class="headerlink" title="HTTP请求的方法"></a>HTTP请求的方法</h2><ul>
<li>GET : 请求指定资源，只用于获取数据。</li>
<li>POST : 发送数据给服务器. 请求主体的类型由 Content-Type 首部指定。</li>
<li>HEAD : 和GET方法一样，但是只返回报文首部信息，用与确认URI的有效性,使用场景是在下载一个大文件之前先获取其大小再决定下载，节约带宽资源。</li>
<li>OPTIONS : 用来查询指定的URI所支持的请求方法，可以发送一个预检请求，来检测实际请求能否被服务器接受。</li>
<li>PUT : 用来传输文件，如果指定的URI上的资源已经在源服务器上存在，则更新文件内容并返回200，如果指定资源不存在，则根据URI的标识定义一个新资源并返回201。该方法不带任何验证机制，有很大的安全隐患。</li>
<li>DELETE : 用来删除指定URI的文件，如果请求删除成功则返回200，如果请求删除的资源不存在则返回204，和PUT方法一样，不推荐使用。</li>
<li>CONNECT : 要求使用隧道协议来连接代理服务器，让代理服务器去请求目标服务器并将数据返回给用户，说白了就是翻墙。可以用来访问使用了SSL（https）协议的站点。</li>
<li>TRACE : 用来确认连接过程中发生的一系列操作，会将web服务器之前的请求通信返回给客户端。</li>
</ul>
<p><strong>幂等 idempotent</strong> : 方法执行一次或多次的效果是一样的，即没有副作用。POST、CONNECT方法为非幂等。</p>
<h3 id="GET、POST请求的区别"><a href="#GET、POST请求的区别" class="headerlink" title="* GET、POST请求的区别"></a>* GET、POST请求的区别</h3><p>一般我们在讨论GET、POST的区别包括面试的时候，讨论的都是specification而并不是implementation。看了很多很多关于GET、POST区别的文章几乎都在说implementation，包括<a href="http://www.w3school.com.cn/tags/html_ref_httpmethods.asp" target="_blank" rel="noopener">w3school</a>给出的答案也非常的粗浅，然鹅这些并不是我想要的答案。</p>
<ul>
<li>GET、POST都有各自的语义，GET是用来获取数据，POST是用来发送数据。方法是否安全、幂等、可缓存都需要根据客户端、服务端的具体操作去判断，协议中的规定不等于实现。总之在使用时必须考虑其语义，做出符合语义的行为。</li>
</ul>
<blockquote>
<p>推荐两篇不错的文章<br><a href="https://sunshinevvv.coding.me/blog/2017/02/09/HttpGETv.s.POST/" target="_blank" rel="noopener">HTTP协议中GET和POST方法的区别</a><br><a href="https://zhuanlan.zhihu.com/p/25028045" target="_blank" rel="noopener">听说『99% 的人都理解错了 HTTP 中 GET 与 POST 的区别』？？</a></p>
</blockquote>
<h2 id="HTTP状态码-RFC7231"><a href="#HTTP状态码-RFC7231" class="headerlink" title="HTTP状态码 RFC7231"></a>HTTP状态码 RFC7231</h2><p><strong> http状态码的职责就是当客户端向服务端发起请求时，描述此次请求返回的结果，通过状态吗可以知道服务端是否正常处理请求，通知出现的错误。</strong></p>
<table>
<thead>
<tr>
<th></th>
<th>类别</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>1XX</td>
<td>Informational</td>
<td>信息，接受的请求正在处理</td>
</tr>
<tr>
<td>2XX</td>
<td>Successful</td>
<td>成功，操作被成功接收并处理</td>
</tr>
<tr>
<td>3XX</td>
<td>Redirection</td>
<td>重定向，需要进一步的操作以完成请求</td>
</tr>
<tr>
<td>4XX</td>
<td>Client Error</td>
<td>客户端错误，服务器无法完成请求</td>
</tr>
<tr>
<td>5XX</td>
<td>Server Error</td>
<td>服务端错误，服务端处理请求出错</td>
</tr>
</tbody>
</table>
<p><strong>200 ok</strong> 请求已成功，响应的实体内容取决于请求方法。</p>
<p><strong>204 No Content</strong> 服务器已成功处理请求，但是返回的实体主体中没有内容，用于只需要服务端通知是否成功，而不需要返回任何内容的情况，例如：保存。</p>
<p><strong>206 Partial Content</strong> 服务器成功完成对目标资源的范围请求，响应请求Range中表示的一个或多个部分</p>
<p><strong>301 Moved Permanently</strong> 目标资源及其资源的引用已被永久分配到一个新的URI，服务端响应Location字段跳转至新的URI，浏览器将会对此跳转进行缓存，使用此状态码需谨慎。</p>
<p><strong>302 Found</strong> 目标资源已找到，但是存放在其它的URI下，由于历史原因，用户代理可将POST改为GET用于后续请求。</p>
<p><strong>303 See Other</strong> 通常作为 PUT 或 POST 操作的返回结果，它表示重定向链接指向的不是新上传的资源，而是另外一个页面。而请求重定向页面的方法要必须使用 GET。</p>
<p><strong>307 Temporary Redirect</strong> 目标资源临时存放在不同的URI下，如果用户代理执行自动重定向到该URI，则不得更改请求方法，因为POST方法不是幂等的，返回值可能和用户所期望的不同。与302相似，但不允许将POST改为GET。</p>
<p><strong>308 Permanent Redirect</strong> 同307。与301相似，但不允许将POST改为GET。</p>
<p><strong>304 Not Modified</strong> 已接收到GET或HEAD请求，如果不存在请求条件则返回200，否则根据此请求的条件If-Modified-Since或If-None-Match的值来判断客户端的资源是否是最新的，如果是则返回304且实体主体为空，否则返回200且实体主体为最新的内容。<br>一般来说if-modified-since的值来自于上一次这条请求的Response中的Last-Modified，if-none-match的值来自于上一次这条请求的Response中的Etag</p>
<p><strong>400 Bad Request</strong> 客户端错误，请求的合适或语法错误导致请求无效。</p>
<p><strong>403 Forbidden</strong> 服务端已理解请求，但拒绝授权。客户端访问权限不足。</p>
<p><strong>404 Not Found</strong> 源服务器未找到目标资源或不愿透露目标资源。但不表示这种资源缺少是永久性的。</p>
<p><strong>410 Gone</strong> 源服务器上不再可以访问该资源，且是永久性的。</p>
<p><strong>500 Internal Server Error</strong> 服务器遇到意外的情况，无法完成请求。</p>
<p><strong>503 Service Unavailable</strong> 服务器当前由于过载或维护无法完成请求。</p>
<h2 id="HTTP首部"><a href="#HTTP首部" class="headerlink" title="HTTP首部"></a>HTTP首部</h2><p>首部的中分别存放客户端和服务端处理请求和响应请求所需要的信息。<br>本章只介绍几个常用的字段和指令，如想深入了解请出门右拐。➡️<br><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP" target="_blank" rel="noopener">MDN HTTP headers</a><br><a href="https://tools.ietf.org/html/rfc2616" target="_blank" rel="noopener">RFC2616</a></p>
<h3 id="HTTP通用首部字段-General"><a href="#HTTP通用首部字段-General" class="headerlink" title="HTTP通用首部字段 General"></a>HTTP通用首部字段 General</h3><p>可以应用于请求和响应中的，但不能用于实体主体。</p>
<h4 id="Cache-Control"><a href="#Cache-Control" class="headerlink" title="Cache-Control"></a>Cache-Control</h4><p>控制缓存，缓存指令是单向的，这意味着在请求中设置的指令，不一定被包含在响应中。</p>
<ul>
<li>public：响应可以被任何用户或对象缓存（客户端、代理服务器等）。</li>
<li>private：响应只对特定的用户或对象缓存，代理服务器不可缓存。</li>
<li>no-cache：不缓存过期资源，在处理资源之前会强制向源服务器发起验证。</li>
<li>no-store：不缓存任何内容。</li>
<li>max-age：设置缓存的最大周期（秒）。</li>
<li>immutable：表示响应正文不会随时间而改变。如果资源的max-age未到期，服务端的资源内容将不会改变，因此客户端不应发送重新验证请求来检查更新。减少页面刷新所造成的服务器处理304请求的压力。</li>
<li>s-maxage：覆盖max-age，设置代理服务器缓存的最大周期（秒）。</li>
<li>no-transform：不得对资源进行转换或转变。如：非透明代理可能将图片进行格式转换或压缩。</li>
</ul>
<h4 id="Connection"><a href="#Connection" class="headerlink" title="Connection"></a>Connection</h4><p>控制不再转发给代理的首部字段、管理持久连接。</p>
<ul>
<li>keep-alive：TCP长连接，保持连接（HTTP1.1版本以前默认非持久连接，需要加上该指令。chrome单次并发连接数为6）。</li>
<li>close：客户端或服务端想要关闭该网络连接。</li>
</ul>
<h4 id="Date"><a href="#Date" class="headerlink" title="Date"></a>Date</h4><p>创建HTTP报文的日期和时间</p>
<h4 id="Pragma"><a href="#Pragma" class="headerlink" title="Pragma"></a>Pragma</h4><p>历史遗留字段，仅用于HTTP1.0版本向后兼容，与Cache-Control:no-cache效果一致</p>
<h4 id="Traier"><a href="#Traier" class="headerlink" title="Traier"></a>Traier</h4><p>Trailer是一个响应首部，允许发送方在分块发送的消息后面添加额外的元信息。</p>
<h4 id="Transfer-Encoding"><a href="#Transfer-Encoding" class="headerlink" title="Transfer-Encoding"></a>Transfer-Encoding</h4><p>规定传输实体主体时采用的编码方式。<br>chunked、compress、deflate、gzip、identity(不压缩)</p>
<h4 id="Upgrade"><a href="#Upgrade" class="headerlink" title="Upgrade"></a>Upgrade</h4><p>切换协议，使用此字段时还需指定Connection：upgrade，服务端可返回101 Switching Protocols</p>
<h4 id="Via"><a href="#Via" class="headerlink" title="Via"></a>Via</h4><p>由代理服务器添加，适用于正向代理、反向代理。用于追踪报文的传输路径、防止循环请求。</p>
<h3 id="HTTP请求首部-Request-Headers"><a href="#HTTP请求首部-Request-Headers" class="headerlink" title="HTTP请求首部 Request Headers"></a>HTTP请求首部 Request Headers</h3><h4 id="Accept"><a href="#Accept" class="headerlink" title="Accept"></a>Accept</h4><p>客户端能够响应的媒体类型(<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Basics_of_HTTP/MIME_types" target="_blank" rel="noopener">MIME types</a>)及对应的优先级，q代表权重。      </p>
<pre><code>accept:text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,\*/\*;q=0.8,application/signed-exchange;v=b3
</code></pre><h4 id="Accept-Charset"><a href="#Accept-Charset" class="headerlink" title="Accept-Charset"></a>Accept-Charset</h4><p>客户端告诉服务端能够处理的字符集。q代表权重。</p>
<h4 id="Accept-Encoding"><a href="#Accept-Encoding" class="headerlink" title="Accept-Encoding"></a>Accept-Encoding</h4><p>客户端能够理解的内容编码方式。</p>
<pre><code>accept-encoding: gzip, deflate, br
</code></pre><p>br：Brotli</p>
<h4 id="Accept-Language"><a href="#Accept-Language" class="headerlink" title="Accept-Language"></a>Accept-Language</h4><p>客户端可以理解的自然语言集。q代表权重。</p>
<pre><code>accept-language: zh-CN,zh;q=0.9
</code></pre><h4 id="Range"><a href="#Range" class="headerlink" title="Range"></a>Range</h4><p>范围请求，告诉服务端返回文件的哪一部分。若成功则返回206 Partial Content，失败返回416 Range Not Satisfiable。</p>
<h4 id="条件请求"><a href="#条件请求" class="headerlink" title="条件请求"></a>条件请求</h4><p>服务端在接收到此类条件后，只有判断条件满足时才会返回资源。</p>
<ul>
<li><p>If-Match ==&gt; ETag<br>在GET和HEAD请求的情况下，请求的资源满足列出的ETag之一时才返回资源。<br>-If-None-Match ==&gt; ETag<br>与If-Match作用相反，在不满足ETag时返回资源。与If-Modified-Since同时出现时优先级较高。</p>
</li>
<li><p>If-Modified-Since ==&gt; Last-Modified<br>如果服务端在指定日期之后有更新过资源则返回资源并且状态码为200，否则返回304 Not Modified，并在Last-modified上带上上次修改的日期。</p>
</li>
<li><p>If-Unmodified-Since ==&gt; Last-Modified<br>与If-Modified-Since作用相反，服务器在指定日期之后没有更新过资源才会返回。否则返回401</p>
</li>
<li><p>If-Range<br>使Range头字段在一定条件下才会起作用。即可使用Last-Modified时间值验证，也可使用ETag标签来作为验证，但不能同时使用。<br>一般用于断点续传的过程中，验证资源是否发生改变。</p>
</li>
<li><p>Referrer<br>包含了当前请求页面的来源页面的地址<url>，即上一跳地址。一般用于统计访问来源。</url></p>
</li>
</ul>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Content_negotiation" target="_blank" rel="noopener">内容协商机制</a></p>
<h3 id="HTTP响应首部-Response-Headers"><a href="#HTTP响应首部-Response-Headers" class="headerlink" title="HTTP响应首部 Response Headers"></a>HTTP响应首部 Response Headers</h3><h4 id="Accept-Range"><a href="#Accept-Range" class="headerlink" title="Accept-Range"></a>Accept-Range</h4><p>返回指令bytes则表示支持范围请求，none则不支持，等同于不返回该头部</p>
<h4 id="Age"><a href="#Age" class="headerlink" title="Age"></a>Age</h4><p>表示该信息在缓存中存贮的时间，以秒为单位</p>
<h4 id="ETag"><a href="#ETag" class="headerlink" title="ETag"></a>ETag</h4><p>可用字符串对资源做唯一标示，当资源更新是ETag的值也需要更新，类似于指纹。</p>
<ul>
<li>强ETag：不管实体发生多细微的变化都会改变值，如：ETag：”value”</li>
<li>弱ETag：弱验证器，只有当实体主体发生根本的改变时才会改变值，如：ETag：”W/value”; (W大写)</li>
</ul>
<h4 id="Location、Content-Location"><a href="#Location、Content-Location" class="headerlink" title="Location、Content-Location"></a>Location、Content-Location</h4><p>Location：需要将页面重定向到新的地址，Location：<url><br>Content-Location：报文主体返回对应资源经过内容协商后的URL</url></p>
<p>Location 与 Content-Location是不同的，前者（Location ）指定的是一个重定向请求的目的地址（或者新创建的文件的URL），而后者（ Content-Location） 指向的是可供访问的资源的直接地址，不需要进行进一步的内容协商。Location 对应的是响应，而Content-Location对应的是要返回的实体。</p>
<h4 id="Vary"><a href="#Vary" class="headerlink" title="Vary"></a>Vary</h4><p>仅在Vary字段中指定字段的值相同时返回缓存，否则需要向源服务器重新获取资源。</p>
<h4 id="Allow"><a href="#Allow" class="headerlink" title="Allow"></a>Allow</h4><p>枚举资源所支持的HTTP方法的集合</p>
<h4 id="Expires"><a href="#Expires" class="headerlink" title="Expires"></a>Expires</h4><p>时间戳，在指定时间之后，响应过期，即资源失效日期。</p>
<h4 id="Last-Modified"><a href="#Last-Modified" class="headerlink" title="Last-Modified"></a>Last-Modified</h4><p>资源的修改日期。<week>, <day> <month> <year> <hour>:<minute>:<second> GMT</second></minute></hour></year></month></day></week></p>
<h2 id="HTTP的特点"><a href="#HTTP的特点" class="headerlink" title="HTTP的特点"></a>HTTP的特点</h2><ul>
<li>一次链接只能发送一个请求</li>
<li>请求只能从客户端开始</li>
<li>首部未压缩且每次都要发送相同首部、未强制压缩</li>
<li>无法证明报文的完整性</li>
</ul>
<h3 id="灵活"><a href="#灵活" class="headerlink" title="灵活"></a>灵活</h3><p>简单、快速。<br>允许传输任意类型的数据对象。<br>客户端发起请求，服务端响应。</p>
<p>SPDY：基于TCP的会话层协议，多路复用、请求优先级、报头压缩、服务器推送，已被HTTP/2取代</p>
<h3 id="无状态"><a href="#无状态" class="headerlink" title="无状态"></a>无状态</h3><p>是指协议对于事务处理没有记忆能力。缺少状态意味着如果后续处理需要前面的信息，则它必须重传，这样可能导致每次连接传送的数据量增大。</p>
<p>cookie：客户端记录信息<br>session：服务端记录客户端状态</p>
<p><a href="https://www.cnblogs.com/andy-zhou/p/5360107.html" target="_blank" rel="noopener">理解cookie和session机制</a></p>
<h3 id="无连接"><a href="#无连接" class="headerlink" title="无连接"></a>无连接</h3><p>每次连接只处理一个请求，服务端处理完请求并受到客户端应答后，即断开连接。</p>
<p>keep-alive：默认保持长连接。<br>WebSocket：在单个TCP连接上进行全双工通讯的协议。</p>
<p><a href="https://www.cnblogs.com/xuxinstyle/p/9813654.html" target="_blank" rel="noopener">深入理解HTTP协议的特点</a></p>
<h4 id="通信方式："><a href="#通信方式：" class="headerlink" title="通信方式："></a>通信方式：</h4><ul>
<li>单工通信：只能有一个方向的通信，没有反方向交互。即只能我发给你，不能你发给我。</li>
<li>半双工通信：通信的双方都可以发送信息，但双方不能同时发送。</li>
<li>全双工通信：通信双方可以同时发送和接收信息。</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/05/15/packet-capture/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr.J">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/logo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hey">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/05/15/packet-capture/" class="post-title-link" itemprop="url">关于抓包（packet capture）</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-05-15 23:13:17" itemprop="dateCreated datePublished" datetime="2019-05-15T23:13:17+00:00">2019-05-15</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2020-06-06 09:36:31" itemprop="dateModified" datetime="2020-06-06T09:36:31+00:00">2020-06-06</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/TCP-IP/" itemprop="url" rel="index"><span itemprop="name">TCP/IP</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2019/05/15/packet-capture/" class="leancloud_visitors" data-flag-title="关于抓包（packet capture）">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">Views: </span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>看标题也知道咯，此篇分享呢主要是向大家分享一些我在日常工作中使用到的一些工具以及如何去使用它帮助我们解决开发中截获、编辑、分析网络数据包的问题。</p>
<h3 id="Proxy-SwitchyOmega"><a href="#Proxy-SwitchyOmega" class="headerlink" title="Proxy SwitchyOmega"></a>Proxy SwitchyOmega</h3><p>在开始之前呢先分享一个chrome的拓展程序 Proxy SwitchyOmega。非常轻量级的一个应用程序，可以轻松快捷地管理和切换多个代理设置，操作之简便，使用之方便。</p>
<p>首先下载它 — 进入程序 — 点击新建情景模式 — 选择代理的协议、服务器、端口 — 点击工具栏的图标选择对应的情景模式就可以了。<br><img src="https://ruixiaojia-blog.oss-cn-hangzhou.aliyuncs.com/blog/packet-capture/proxy.png?x-oss-process=style/compression" alt="proxy-switchyOmega"></p>
<hr>
<h2 id="Charles"><a href="#Charles" class="headerlink" title="Charles"></a>Charles</h2><p>Charles其实是一款代理服务器，通过将自己设置成系统（电脑或者浏览器）的网络访问代理服务器，然后截取请求和请求结果达到分析抓包的目的。该软件是用Java写的，能够在Windows，Mac，Linux上使用,但是它是收费的，只能免费使用30分钟，超时必须重新打开，自行查找破解版。</p>
<h3 id="Charles的主要功能"><a href="#Charles的主要功能" class="headerlink" title="Charles的主要功能:"></a>Charles的主要功能:</h3><ul>
<li>截取Http 和 Https 网络封包。</li>
<li>重发网络请求，方便后端调试。</li>
<li>修改网络请求参数。</li>
<li>网络请求的截获并动态修改。</li>
<li>模拟慢速网络。</li>
</ul>
<h3 id="Charles抓包"><a href="#Charles抓包" class="headerlink" title="Charles抓包:"></a>Charles抓包:</h3><p>这时候就需要使用到Proxy SwitchyOmega了，将其打开，添加情景模式，将服务器设置为127.0.0.1，代理端口为8888，当然也可以将端口设置为其他，需要在charles工具栏中点击poxy — 勾选macOS Proxy/windows Proxy — Proxy Settings — 更改端口号后保存即可。<br><img src="https://ruixiaojia-blog.oss-cn-hangzhou.aliyuncs.com/blog/packet-capture/charles1.png?x-oss-process=style/compression" alt="charles"></p>
<h3 id="Charles抓取https"><a href="#Charles抓取https" class="headerlink" title="Charles抓取https:"></a>Charles抓取https:</h3><p><img src="https://ruixiaojia-blog.oss-cn-hangzhou.aliyuncs.com/blog/packet-capture/charles2.png?x-oss-process=style/compression" alt="charles"><br>打开charles可以看到上图中左边的红框里面已经抓到一些数据了，但是https前面多了一把锁，表示https是没有抓到数据包的，这时候你的电脑需要装charles的证书，同时要信任，且charles要开启https代理。</p>
<ul>
<li><p>开启https代理如下图所示：<br>其中<em>:</em> 代表所有域名和协议下面所有的端口<br><img src="https://ruixiaojia-blog.oss-cn-hangzhou.aliyuncs.com/blog/packet-capture/charles3.png?x-oss-process=style/compression" alt="charles"></p>
</li>
<li><p>电脑安装证书：<br><img src="https://ruixiaojia-blog.oss-cn-hangzhou.aliyuncs.com/blog/packet-capture/charles4.png?x-oss-process=style/compression" alt="charles"></p>
</li>
<li><p>点击install Charles Root Certificate后会在你的系统钥匙串里面装一个证书，但证书是不被信任的，此时我们要信任此证书。<br><img src="https://ruixiaojia-blog.oss-cn-hangzhou.aliyuncs.com/blog/packet-capture/charles5.png?x-oss-process=style/compression" alt="charles"></p>
</li>
<li><p>手机安装证书:（以iPhone为例）<br>1、确保手机和电脑在同一局域网内<br>2、打开手机设置 — 选择已连接的无线网络 — 找到配置代理 — 填写代理服务器为电脑的IP,端口为8888<br>3、然后在手机浏览器里面输入chls.pro/ssl这时候会提示你下载描述文件，然后安装，iPhone手机记得在关于本机里面信任证书，安卓手机，如果用原生的浏览器装不上，那就下个Chrome在Chrome里面打开chls.pro/ssl这个地址</p>
</li>
</ul>
<hr>
<h2 id="Whistle"><a href="#Whistle" class="headerlink" title="Whistle"></a>Whistle</h2><p>基于Node实现的跨平台web调试代理工具,所以下载前首先确保你已安装node。功能之强大，操作之简便，比较适合前端开发同学使用的工具，也是我个人比较喜欢的一款工具。<br>官文比较详细，还配有中文版的教程，如何下载使用我这里就不赘述了,直接附上地址。<br><a href="https://github.com/avwo/whistle" target="_blank" rel="noopener">github地址</a><br><a href="http://wproxy.org/whistle/" target="_blank" rel="noopener">中文文档</a></p>
<hr>
<h2 id="Wireshark"><a href="#Wireshark" class="headerlink" title="Wireshark"></a>Wireshark</h2><p>我们先将其设置为中文，这样的话使用会比较方便<br><img src="https://ruixiaojia-blog.oss-cn-hangzhou.aliyuncs.com/blog/packet-capture/wireshark1.png?x-oss-process=style/compression" alt="wireshark"></p>
<p>选择对应的网卡后进入主界面<br><img src="https://ruixiaojia-blog.oss-cn-hangzhou.aliyuncs.com/blog/packet-capture/wireshark2.jpg?x-oss-process=style/compression" alt="wireshark"></p>
<p>这个时候你已经可以看到界面刷刷刷不停的在加载了，我的马鸭怎么回事😱<br>好了不要慌。。。点左上角的红色方块就可以让它停下来。</p>
<h3 id="对应网络层级"><a href="#对应网络层级" class="headerlink" title="对应网络层级"></a>对应网络层级</h3><p>点击分组后我们可以看到下方的封包详细信息，它对应TCP/IP五层网络模型中的每一层，以HTTP为例：<br><img src="https://ruixiaojia-blog.oss-cn-hangzhou.aliyuncs.com/blog/packet-capture/wireshark3.jpg?x-oss-process=style/compression" alt="wireshark"></p>
<h3 id="TCP包内容"><a href="#TCP包内容" class="headerlink" title="TCP包内容"></a>TCP包内容</h3><p><img src="https://ruixiaojia-blog.oss-cn-hangzhou.aliyuncs.com/blog/packet-capture/wireshark4.jpg?x-oss-process=style/compression" alt="wireshark"></p>
<h3 id="TCP建立连接（三次握手🤝）"><a href="#TCP建立连接（三次握手🤝）" class="headerlink" title="TCP建立连接（三次握手🤝）"></a>TCP建立连接（三次握手🤝）</h3><p><img src="https://ruixiaojia-blog.oss-cn-hangzhou.aliyuncs.com/blog/packet-capture/tcp1.jpg?x-oss-process=style/compression" alt="tcp"><br>我们可以看到这次TCP连接的完整过程，连接完成后建立TLS隧道连接。<br>此例子中30.38.36.123为客户端，52.231.18.241为服务端。</p>
<h4 id="第一次握手"><a href="#第一次握手" class="headerlink" title="第一次握手"></a>第一次握手</h4><p>客户端向服务端发出请求连接的报文，其中同步位SYN置为1，并选择了序号seq为x，TCP规定SYN报文段（即SYN为1的报文）不能携带数据（可以看到LEN=0），并且需要消耗一个序号,此时客户端进入SYN-SENT同步已发送状态。</p>
<p><img src="https://ruixiaojia-blog.oss-cn-hangzhou.aliyuncs.com/blog/packet-capture/tcp2.jpg?x-oss-process=style/compression" alt="tcp"></p>
<h4 id="第二次握手"><a href="#第二次握手" class="headerlink" title="第二次握手"></a>第二次握手</h4><p>服务端在收到请求报文段后如果同意连接，则向客户端发送确认。在确认报文段中将SYN、ACK都置为1，确认号Ack为x+1，同时也为自己选择一个序号y（客户端和服务端的序号不相同），此报文段也不携带数据且也需要消耗一个序号。此时服务器进入SYN-RCVD同步收到状态。<br><img src="https://ruixiaojia-blog.oss-cn-hangzhou.aliyuncs.com/blog/packet-capture/tcp3.jpg?x-oss-process=style/compression" alt="tcp"></p>
<h4 id="第三次握手"><a href="#第三次握手" class="headerlink" title="第三次握手"></a>第三次握手</h4><p>客户端在收到服务端的确认后，还要向服务端再次发出确认，将确认ACK置为1，确认号Ack为y+1，同时将自己的序号seq置为x+1。此时客户端进入ESTABLISHED已建立连接状态。<br>服务端在收到确认后也进入ESTABLISHED状态。<br><img src="https://ruixiaojia-blog.oss-cn-hangzhou.aliyuncs.com/blog/packet-capture/tcp4.jpg?x-oss-process=style/compression" alt="tcp"></p>
<p><strong>序号seq</strong> ： 本段报文中所发送的数据的第一个字节的序号，例如：本段报文的序号为0，本段报文长度100字节，下段报文的seq就为101。<br><strong>确认号Ack</strong> ： 期望收到对方下一报文段的第一个数据字节的序号。仅在控制位中确认ACK为1时确认号才有效。<br><strong>确认ACK</strong> ： 在连接建立后所有传送的报文段都必须将ACK置为1。<br><strong>同步SYN</strong> ： 在建立连接时用来同步序号。TCP规定SYN报文段不得携带数据。</p>
<h3 id="过滤表达式"><a href="#过滤表达式" class="headerlink" title="过滤表达式"></a>过滤表达式</h3><p>使用正确的表达式可以快速的从茫茫数据中找到你想要的那一堆。</p>
<ul>
<li>逻辑运算符 ： and、or</li>
<li>http ：只看http协议或其它协议名</li>
<li>ip.src == 127.0.0.1 ： 源IP地址为127.0.0.1的封包</li>
<li>ip.dst == 0.0.0.0 ： 目标地址为0.0.0.0的封包</li>
<li>tcp.port == 80 ：端口为80的</li>
<li>tcp.srcport == 443 ：源端口为443的</li>
<li>http.request.method == “GET” ：只显示GET方法的请求。</li>
</ul>
<blockquote>
<p>分享两篇文章，如果想深入学习Wireshark可以看看<br><a href="http://www.cnblogs.com/TankXiao/archive/2012/10/10/2711777.html" target="_blank" rel="noopener">http://www.cnblogs.com/TankXiao/archive/2012/10/10/2711777.html</a><br><a href="https://www.cnblogs.com/dragonir/p/6219541.html" target="_blank" rel="noopener">https://www.cnblogs.com/dragonir/p/6219541.html</a></p>
</blockquote>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/26/secure-shell/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr.J">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/logo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hey">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/04/26/secure-shell/" class="post-title-link" itemprop="url">关于SSH（Secure Shell）安全外壳协议</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-04-26 11:22:16" itemprop="dateCreated datePublished" datetime="2019-04-26T11:22:16+00:00">2019-04-26</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2020-06-06 09:36:31" itemprop="dateModified" datetime="2020-06-06T09:36:31+00:00">2020-06-06</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/SSH/" itemprop="url" rel="index"><span itemprop="name">SSH</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2019/04/26/secure-shell/" class="leancloud_visitors" data-flag-title="关于SSH（Secure Shell）安全外壳协议">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">Views: </span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在了解SSH安全外壳协议之前，我们需要大致了解一下对称加密和非对称加密以及数字签名，推荐一篇很好的文章来理解<a href="http://www.ruanyifeng.com/blog/2011/08/what_is_a_digital_signature.html" target="_blank" rel="noopener">什么是数字签名</a>，文章中鲍勃扮演客户端，苏珊扮演服务端。</p>
<h4 id="对称加密"><a href="#对称加密" class="headerlink" title="对称加密"></a>对称加密</h4><p>是一种采用单钥密码系统加密的方法，即同一个密钥即可用做加密也可用作解密，也称之为单密钥加密。</p>
<p><strong>常用的算法</strong>:    MD5（消息摘要算法）、SHA（安全散列算法）<br><strong>优点</strong>:    加密解密的速度比较快，适合长时间使用的数据。<br><strong>缺点</strong> :    加密解密都是使用同一密钥，机密性完全依赖于密钥，密钥的传输和保存存在安全问题，容易泄露、破解，当通信对象增多时密钥的管理也较麻烦。</p>
<h4 id="非对称加密"><a href="#非对称加密" class="headerlink" title="非对称加密"></a>非对称加密</h4><p>需要有两个密钥来进行加密和解密，公钥（public key）、私钥（privare key），如果用公钥对数据进行加密，只有使用对应的私钥才能解密。如果用私钥对数据进行加密，则只能用公钥才能将数据解密。加密和解密需要使用不同的密钥。</p>
<p><strong>常用的算法</strong>:    RSA、DSA<br><strong>优点</strong>:    与对称加密相比，其安全性更好。<br><strong>缺点</strong> :    加密和解密花费时间长、速度慢，只适合对少量数据进行加密。</p>
<hr>
<h3 id="SSH（Secure-Shell）安全外壳协议"><a href="#SSH（Secure-Shell）安全外壳协议" class="headerlink" title="SSH（Secure Shell）安全外壳协议"></a>SSH（Secure Shell）安全外壳协议</h3><h4 id="什么是SSH-？"><a href="#什么是SSH-？" class="headerlink" title="什么是SSH ？"></a>什么是SSH ？</h4><ul>
<li>充分利用了对称加密、非对称加密来实现计算机之间的加密登陆和安全数据传输。</li>
<li>SSH是建立在应用层基础上的安全协议，专为远程登陆会话和其他网络服务提供安全性的协议。</li>
</ul>
<h4 id="主要特征"><a href="#主要特征" class="headerlink" title="主要特征"></a>主要特征</h4><ul>
<li>加密：避免数据泄露</li>
<li>通信的完整性：保证数据在传输过程中不会丢失、被篡改。</li>
<li>认证：识别数据发送者、接受者身份，避免中间人攻击和重定向请求攻击。</li>
</ul>
<h4 id="主要阶段"><a href="#主要阶段" class="headerlink" title="主要阶段"></a>主要阶段</h4><ul>
<li><h5 id="协议协商阶段"><a href="#协议协商阶段" class="headerlink" title="协议协商阶段"></a>协议协商阶段</h5><ol>
<li>服务端打开服务端口（默认22），等待客户端连接。</li>
<li>客户端发起TCP连接请求，并建立TCP连接，之后向客户端发送SSH协议版本信息。</li>
<li>客户端根据收到的版本信息决定将要使用的SSH版本，并向服务端发送。</li>
<li>服务端检查是否支持客户端决定使用的SSH版本。若支持，则双方完成协议协商，与客户端建立明文的通信通道进入服务端认证阶段，若版本不兼容，则双方都可断开连接。</li>
</ol>
</li>
<li><h5 id="服务端认证阶段"><a href="#服务端认证阶段" class="headerlink" title="服务端认证阶段"></a>服务端认证阶段</h5><ol>
<li>服务端向客户端发送以下内容：<ul>
<li>host key：用于认证服务端身份。</li>
<li>server key： 用于帮助建立安全的数据传输通道。</li>
<li>8字节的随机数：客户端在下次响应中包含随机数，来防止IP欺诈。</li>
<li>服务端支持的压缩方式、加密算法、认证方式。</li>
</ul>
</li>
<li>客户端在收到服务端发送的host key后会在本地的known host库（～/.ssh/known_host）文件中查找是否包含当前服务端发送的host key，如果有则下一步，如果没有则可以选择是否信任该服务端，或终止当前链接。</li>
<li>客户端需要向服务端发送session key（不可泄露）用于建立安全通信，出于性能考虑，SSH采用对称加密的方式，由当前的通信通道还是采用明文方式，需要用host key和server key（都为非对称加密）来对session key进行两次加密。</li>
<li>服务端收到session key后对其解密，完成安全通道的建立。在正式使用安全通道前客户端要求服务端再次使用session key加密的确认信息，以确认服务端身份。</li>
</ol>
</li>
<li><h5 id="客户端认证阶段"><a href="#客户端认证阶段" class="headerlink" title="客户端认证阶段"></a>客户端认证阶段</h5>  安全通道已经成功建立，之后所有通信内容都是通过session key加密后进行传输。<ol>
<li><strong>password</strong>：即客户端提供用户名和密码，服务端通过用户名和密码对客户端身份进行认证。</li>
<li><strong>public key</strong>：基于非对称加密，客户端需要将生成的公钥储存在服务端，服务端用公钥将数据进行加密，客户端若能用私钥对其进行解密则可证明身份。</li>
</ol>
</li>
<li><h5 id="数据传输阶段"><a href="#数据传输阶段" class="headerlink" title="数据传输阶段"></a>数据传输阶段</h5>  该阶段通过session key提供的加密算法，来保证通信过程中的数据安全。</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/15/git-ssh/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr.J">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/logo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hey">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/04/15/git-ssh/" class="post-title-link" itemprop="url">同时配置 gitlab & github</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-04-15 10:44:41" itemprop="dateCreated datePublished" datetime="2019-04-15T10:44:41+00:00">2019-04-15</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2020-06-06 09:36:31" itemprop="dateModified" datetime="2020-06-06T09:36:31+00:00">2020-06-06</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Git/" itemprop="url" rel="index"><span itemprop="name">Git</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2019/04/15/git-ssh/" class="leancloud_visitors" data-flag-title="同时配置 gitlab & github">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">Views: </span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>这将是我写的第一篇文章，其实也不能称之为文章吧，就叫分享好了。为什么写这篇分享呢，第一是记性不好，踩过的坑总是忘记，用这种方法记录下来的话可以避免重新踩坑也可以避免忘记了想不起来是怎么回事，也是一种沉淀吧。第二呢就是告诉自己，遇到困难一定尽最大的力去解决，不要总是麻烦别人，学习的道路很艰辛最重要的是成长。第三呢就是希望也能够帮助到同样遇到这样的问题不知该如何解决的你。好了，就不废话了。。。</p>
<p>有些时候我们需要同时使用多个git来进行项目管理，比如不同的项目用了不同的github账号，或者使用gitlab的同时又想在自己的github上面作出一点贡献又能避开红线，那么你就需要配置多个密钥。在此我们默认你已经同时拥有了gitlab和github账号。</p>
<h4 id="第一步-全局配置gitlab-github用户名、邮箱。"><a href="#第一步-全局配置gitlab-github用户名、邮箱。" class="headerlink" title="第一步    全局配置gitlab/github用户名、邮箱。"></a>第一步    全局配置gitlab/github用户名、邮箱。</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global user.name your_name</span><br><span class="line">$ git config --global user.email your_email@gmail.com</span><br></pre></td></tr></table></figure>
<p>接下来，进入你的gitlab/github项目目录，配置本地用户名、邮箱,也可以将其配置为全局（–global）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git config --local user.name example</span><br><span class="line">$ git config --local user.email youemail@gmail.com</span><br></pre></td></tr></table></figure>
<p>可以通过以下命令来查看是否配置成功</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git config user.name</span><br><span class="line">$ git config user.email</span><br></pre></td></tr></table></figure>
<h4 id="第二步-生成SSH-key"><a href="#第二步-生成SSH-key" class="headerlink" title="第二步     生成SSH key"></a>第二步     生成SSH key</h4><p>执行以下命令将在～/.ssh 目录下生成对应的gitlab/github的公钥(.pub后缀)、密钥。（～/.ssh/文件夹是默认隐藏的，mac系统使用快捷键”cmd + shift + . “ 显示隐藏文件夹）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh-keygen -t rsa -f ~/.ssh/id_rsa_github -C &quot;your_email@gmail.com&quot;</span><br></pre></td></tr></table></figure></p>
<p>执行完命令后会在～/.ssh/文件夹下生成id_rsa_github(私钥)、id_rsa_github.pub(公钥)和id_rsa(私钥)、id_rsa.pub(公钥)的文件，需要将.pub后缀的文件内容拷贝到你的github/gitlab内。<br>github  –  setting  –  SSH Keys  –  New SSH key  –  Add SSH key。</p>
<h5 id="执行完以上命令后你只是配置了gitlab和github的用户名、邮箱和公钥，但还是不能进行正常的开发。我们需要让git在操作远程仓库的时候知道它现在是在github还是在gitlab上-通过域名-所以我们需要通过一个config文件来区分。"><a href="#执行完以上命令后你只是配置了gitlab和github的用户名、邮箱和公钥，但还是不能进行正常的开发。我们需要让git在操作远程仓库的时候知道它现在是在github还是在gitlab上-通过域名-所以我们需要通过一个config文件来区分。" class="headerlink" title="执行完以上命令后你只是配置了gitlab和github的用户名、邮箱和公钥，但还是不能进行正常的开发。我们需要让git在操作远程仓库的时候知道它现在是在github还是在gitlab上(通过域名), 所以我们需要通过一个config文件来区分。"></a>执行完以上命令后你只是配置了gitlab和github的用户名、邮箱和公钥，但还是不能进行正常的开发。我们需要让git在操作远程仓库的时候知道它现在是在github还是在gitlab上(通过域名), 所以我们需要通过一个config文件来区分。</h5><h4 id="第三步-配置config文件"><a href="#第三步-配置config文件" class="headerlink" title="第三步     配置config文件"></a>第三步     配置config文件</h4><p>创建并修改config文件（不会使用vim可以手动修改）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ touch config</span><br><span class="line"></span><br><span class="line">$ vi config</span><br></pre></td></tr></table></figure></p>
<p>修改config文件内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># github</span><br><span class="line">Host github</span><br><span class="line">User git</span><br><span class="line">HostName github.com</span><br><span class="line">IdentityFile ~/.ssh/id_rsa_github</span><br><span class="line"></span><br><span class="line"># gitlab</span><br><span class="line">Host gitlab</span><br><span class="line">User git</span><br><span class="line">HostName gitlab.xxx.com</span><br><span class="line">IdentityFile ~/.ssh/id_rsa</span><br></pre></td></tr></table></figure></p>
<ul>
<li>Host: 将要链接的服务器地址。</li>
<li>User: 本次链接使用的用户名。</li>
<li>HostName: 真正链接的服务器地址。</li>
<li>IdentityFile: 本次链接指定的密钥文件。</li>
<li>PreferredAuthentications: 指定优先使用哪种方式验证，支持密码和秘钥验证方式。</li>
</ul>
<h4 id="第四步-添加本地SSH"><a href="#第四步-添加本地SSH" class="headerlink" title="第四步     添加本地SSH"></a>第四步     添加本地SSH</h4><p>ssh 连接提示 Permission denied (publickey)，需要将公钥(publickey)添加到本地SSH环境<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd ～/.ssh</span><br><span class="line">$ ssh-add id_rsa_github</span><br></pre></td></tr></table></figure></p>
<p>经常不使用会导致本地SSH失效，需要重新执行第四步</p>
<h4 id="第五步-测试"><a href="#第五步-测试" class="headerlink" title="第五步     测试"></a>第五步     测试</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -T git@github.com</span><br></pre></td></tr></table></figure>
<p>git@ + “config配置中的HostName”</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hi xxx! You&apos;ve successfully authenticated, but GitHub does not provide shell access.</span><br></pre></td></tr></table></figure>
<p>那么，恭喜你。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/logo.jpg" alt="Mr.J">
            
              <p class="site-author-name" itemprop="name">Mr.J</p>
              <div class="site-description motion-element" itemprop="description"></div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">10</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">6</span>
                    <span class="site-state-item-name">categories</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">9</span>
                    <span class="site-state-item-name">tags</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/ruixiaojia" title="GitHub &rarr; https://github.com/ruixiaojia" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Mr.J</span>

  

  
</div>








<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="post-meta-item-icon">
      <i class="fa fa-user"></i>
    </span>
    <span class="site-uv" title="Total Visitors">
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  

  
    <span class="post-meta-divider">|</span>
  

  
    <span class="post-meta-item-icon">
      <i class="fa fa-eye"></i>
    </span>
    <span class="site-pv" title="Total Views">
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>









        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/utils.js?v=7.1.0"></script>

  <script src="/js/motion.js?v=7.1.0"></script>



  
  


  <script src="/js/schemes/muse.js?v=7.1.0"></script>



  

  


  <script src="/js/next-boot.js?v=7.1.0"></script>


  

  

  

  



  




  
  
  <script>
    
    function showTime(Counter) {
      var entries = [];
      var $visitors = $('.leancloud_visitors');

      $visitors.each(function() {
        entries.push( $(this).attr('id').trim() );
      });

      Counter('get', '/classes/Counter', { where: JSON.stringify({ url: { '$in': entries } }) })
        .done(function({ results }) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.url;
            var time = item.time;
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for (var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if (countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function ({ responseJSON }) {
          console.log('LeanCloud Counter Error: ' + responseJSON.code + ' ' + responseJSON.error);
        });
    }
    

    $(function() {
      $.get('https://app-router.leancloud.cn/2/route?appId=' + '')
        .done(function({ api_server }) {
          var Counter = function(method, url, data) {
            return $.ajax({
              method: method,
              url: 'https://' + api_server + '/1.1' + url,
              headers: {
                'X-LC-Id': '',
                'X-LC-Key': '',
                'Content-Type': 'application/json',
              },
              data: data
            });
          };
          
            if ($('.post-title-link').length >= 1) {
              showTime(Counter);
            }
          
        });
    });
  </script>



  

  

  

  

  
  <script>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      bp.src = (curProtocol === 'https') ? 'https://zz.bdstatic.com/linksubmit/push.js' : 'http://push.zhanzhang.baidu.com/push.js';
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>


  

  

  

  

  

  

  

  

</body>
</html>
