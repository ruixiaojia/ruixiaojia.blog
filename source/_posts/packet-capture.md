---
title: å…³äºŽæŠ“åŒ…ï¼ˆpacket captureï¼‰
date: 2019-05-15 23:13:17
tags: Packet Capture
categories: HTTP
---

çœ‹æ ‡é¢˜ä¹ŸçŸ¥é“å’¯ï¼Œæ­¤ç¯‡åˆ†äº«å‘¢ä¸»è¦æ˜¯å‘å¤§å®¶åˆ†äº«ä¸€äº›æˆ‘åœ¨æ—¥å¸¸å·¥ä½œä¸­ä½¿ç”¨åˆ°çš„ä¸€äº›å·¥å…·ä»¥åŠå¦‚ä½•åŽ»ä½¿ç”¨å®ƒå¸®åŠ©æˆ‘ä»¬è§£å†³å¼€å‘ä¸­æˆªèŽ·ã€ç¼–è¾‘ã€åˆ†æžç½‘ç»œæ•°æ®åŒ…çš„é—®é¢˜ã€‚

### Proxy SwitchyOmega
åœ¨å¼€å§‹ä¹‹å‰å‘¢å…ˆåˆ†äº«ä¸€ä¸ªchromeçš„æ‹“å±•ç¨‹åº Proxy SwitchyOmegaã€‚éžå¸¸è½»é‡çº§çš„ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œå¯ä»¥è½»æ¾å¿«æ·åœ°ç®¡ç†å’Œåˆ‡æ¢å¤šä¸ªä»£ç†è®¾ç½®ï¼Œæ“ä½œä¹‹ç®€ä¾¿ï¼Œä½¿ç”¨ä¹‹æ–¹ä¾¿ã€‚

é¦–å…ˆä¸‹è½½å®ƒ â€” è¿›å…¥ç¨‹åº â€” ç‚¹å‡»æ–°å»ºæƒ…æ™¯æ¨¡å¼ â€” é€‰æ‹©ä»£ç†çš„åè®®ã€æœåŠ¡å™¨ã€ç«¯å£ â€” ç‚¹å‡»å·¥å…·æ çš„å›¾æ ‡é€‰æ‹©å¯¹åº”çš„æƒ…æ™¯æ¨¡å¼å°±å¯ä»¥äº†ã€‚
![proxy-switchyOmega](2019/05/15/packet-capture/proxy.png)

***

## Charles
Charleså…¶å®žæ˜¯ä¸€æ¬¾ä»£ç†æœåŠ¡å™¨ï¼Œé€šè¿‡å°†è‡ªå·±è®¾ç½®æˆç³»ç»Ÿï¼ˆç”µè„‘æˆ–è€…æµè§ˆå™¨ï¼‰çš„ç½‘ç»œè®¿é—®ä»£ç†æœåŠ¡å™¨ï¼Œç„¶åŽæˆªå–è¯·æ±‚å’Œè¯·æ±‚ç»“æžœè¾¾åˆ°åˆ†æžæŠ“åŒ…çš„ç›®çš„ã€‚è¯¥è½¯ä»¶æ˜¯ç”¨Javaå†™çš„ï¼Œèƒ½å¤Ÿåœ¨Windowsï¼ŒMacï¼ŒLinuxä¸Šä½¿ç”¨,ä½†æ˜¯å®ƒæ˜¯æ”¶è´¹çš„ï¼Œåªèƒ½å…è´¹ä½¿ç”¨30åˆ†é’Ÿï¼Œè¶…æ—¶å¿…é¡»é‡æ–°æ‰“å¼€ï¼Œè‡ªè¡ŒæŸ¥æ‰¾ç ´è§£ç‰ˆã€‚

### Charlesçš„ä¸»è¦åŠŸèƒ½:
- æˆªå–Http å’Œ Https ç½‘ç»œå°åŒ…ã€‚
- é‡å‘ç½‘ç»œè¯·æ±‚ï¼Œæ–¹ä¾¿åŽç«¯è°ƒè¯•ã€‚
- ä¿®æ”¹ç½‘ç»œè¯·æ±‚å‚æ•°ã€‚
- ç½‘ç»œè¯·æ±‚çš„æˆªèŽ·å¹¶åŠ¨æ€ä¿®æ”¹ã€‚
- æ¨¡æ‹Ÿæ…¢é€Ÿç½‘ç»œã€‚

### CharlesæŠ“åŒ…:
è¿™æ—¶å€™å°±éœ€è¦ä½¿ç”¨åˆ°Proxy SwitchyOmegaäº†ï¼Œå°†å…¶æ‰“å¼€ï¼Œæ·»åŠ æƒ…æ™¯æ¨¡å¼ï¼Œå°†æœåŠ¡å™¨è®¾ç½®ä¸º127.0.0.1ï¼Œä»£ç†ç«¯å£ä¸º8888ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥å°†ç«¯å£è®¾ç½®ä¸ºå…¶ä»–ï¼Œéœ€è¦åœ¨charleså·¥å…·æ ä¸­ç‚¹å‡»poxy â€” å‹¾é€‰macOS Proxy/windows Proxy â€” Proxy Settings â€” æ›´æ”¹ç«¯å£å·åŽä¿å­˜å³å¯ã€‚
![charles](2019/05/15/packet-capture/charles1.png)

### CharlesæŠ“å–https:
![charles](2019/05/15/packet-capture/charles2.png)
æ‰“å¼€charleså¯ä»¥çœ‹åˆ°ä¸Šå›¾ä¸­å·¦è¾¹çš„çº¢æ¡†é‡Œé¢å·²ç»æŠ“åˆ°ä¸€äº›æ•°æ®äº†ï¼Œä½†æ˜¯httpså‰é¢å¤šäº†ä¸€æŠŠé”ï¼Œè¡¨ç¤ºhttpsæ˜¯æ²¡æœ‰æŠ“åˆ°æ•°æ®åŒ…çš„ï¼Œè¿™æ—¶å€™ä½ çš„ç”µè„‘éœ€è¦è£…charlesçš„è¯ä¹¦ï¼ŒåŒæ—¶è¦ä¿¡ä»»ï¼Œä¸”charlesè¦å¼€å¯httpsä»£ç†ã€‚

- å¼€å¯httpsä»£ç†å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
å…¶ä¸­*:* ä»£è¡¨æ‰€æœ‰åŸŸåå’Œåè®®ä¸‹é¢æ‰€æœ‰çš„ç«¯å£
![charles](2019/05/15/packet-capture/charles3.png)

- ç”µè„‘å®‰è£…è¯ä¹¦ï¼š
![charles](2019/05/15/packet-capture/charles4.png)

- ç‚¹å‡»install Charles Root CertificateåŽä¼šåœ¨ä½ çš„ç³»ç»Ÿé’¥åŒ™ä¸²é‡Œé¢è£…ä¸€ä¸ªè¯ä¹¦ï¼Œä½†è¯ä¹¦æ˜¯ä¸è¢«ä¿¡ä»»çš„ï¼Œæ­¤æ—¶æˆ‘ä»¬è¦ä¿¡ä»»æ­¤è¯ä¹¦ã€‚
![charles](2019/05/15/packet-capture/charles5.png)

- æ‰‹æœºå®‰è£…è¯ä¹¦:ï¼ˆä»¥iPhoneä¸ºä¾‹ï¼‰
1ã€ç¡®ä¿æ‰‹æœºå’Œç”µè„‘åœ¨åŒä¸€å±€åŸŸç½‘å†…
2ã€æ‰“å¼€æ‰‹æœºè®¾ç½® â€” é€‰æ‹©å·²è¿žæŽ¥çš„æ— çº¿ç½‘ç»œ â€” æ‰¾åˆ°é…ç½®ä»£ç† â€” å¡«å†™ä»£ç†æœåŠ¡å™¨ä¸ºç”µè„‘çš„IP,ç«¯å£ä¸º8888
3ã€ç„¶åŽåœ¨æ‰‹æœºæµè§ˆå™¨é‡Œé¢è¾“å…¥chls.pro/sslè¿™æ—¶å€™ä¼šæç¤ºä½ ä¸‹è½½æè¿°æ–‡ä»¶ï¼Œç„¶åŽå®‰è£…ï¼ŒiPhoneæ‰‹æœºè®°å¾—åœ¨å…³äºŽæœ¬æœºé‡Œé¢ä¿¡ä»»è¯ä¹¦ï¼Œå®‰å“æ‰‹æœºï¼Œå¦‚æžœç”¨åŽŸç”Ÿçš„æµè§ˆå™¨è£…ä¸ä¸Šï¼Œé‚£å°±ä¸‹ä¸ªChromeåœ¨Chromeé‡Œé¢æ‰“å¼€chls.pro/sslè¿™ä¸ªåœ°å€

***

## Whistle
åŸºäºŽNodeå®žçŽ°çš„è·¨å¹³å°webè°ƒè¯•ä»£ç†å·¥å…·,æ‰€ä»¥ä¸‹è½½å‰é¦–å…ˆç¡®ä¿ä½ å·²å®‰è£…nodeã€‚åŠŸèƒ½ä¹‹å¼ºå¤§ï¼Œæ“ä½œä¹‹ç®€ä¾¿ï¼Œæ¯”è¾ƒé€‚åˆå‰ç«¯å¼€å‘åŒå­¦ä½¿ç”¨çš„å·¥å…·ï¼Œä¹Ÿæ˜¯æˆ‘ä¸ªäººæ¯”è¾ƒå–œæ¬¢çš„ä¸€æ¬¾å·¥å…·ã€‚
å®˜æ–‡æ¯”è¾ƒè¯¦ç»†ï¼Œè¿˜é…æœ‰ä¸­æ–‡ç‰ˆçš„æ•™ç¨‹ï¼Œå¦‚ä½•ä¸‹è½½ä½¿ç”¨æˆ‘è¿™é‡Œå°±ä¸èµ˜è¿°äº†,ç›´æŽ¥é™„ä¸Šåœ°å€ã€‚
[githubåœ°å€](https://github.com/avwo/whistle)
[ä¸­æ–‡æ–‡æ¡£](http://wproxy.org/whistle/)

***

## Wireshark
æˆ‘ä»¬å…ˆå°†å…¶è®¾ç½®ä¸ºä¸­æ–‡ï¼Œè¿™æ ·çš„è¯ä½¿ç”¨ä¼šæ¯”è¾ƒæ–¹ä¾¿
![wireshark](2019/05/15/packet-capture/wireshark1.png)

é€‰æ‹©å¯¹åº”çš„ç½‘å¡åŽè¿›å…¥ä¸»ç•Œé¢
![wireshark](2019/05/15/packet-capture/wireshark2.jpg)

è¿™ä¸ªæ—¶å€™ä½ å·²ç»å¯ä»¥çœ‹åˆ°ç•Œé¢åˆ·åˆ·åˆ·ä¸åœçš„åœ¨åŠ è½½äº†ï¼Œæˆ‘çš„é©¬é¸­æ€Žä¹ˆå›žäº‹ðŸ˜±
å¥½äº†ä¸è¦æ…Œã€‚ã€‚ã€‚ç‚¹å·¦ä¸Šè§’çš„çº¢è‰²æ–¹å—å°±å¯ä»¥è®©å®ƒåœä¸‹æ¥ã€‚

### å¯¹åº”ç½‘ç»œå±‚çº§
ç‚¹å‡»åˆ†ç»„åŽæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸‹æ–¹çš„å°åŒ…è¯¦ç»†ä¿¡æ¯ï¼Œå®ƒå¯¹åº”TCP/IPäº”å±‚ç½‘ç»œæ¨¡åž‹ä¸­çš„æ¯ä¸€å±‚ï¼Œä»¥HTTPä¸ºä¾‹ï¼š
![wireshark](2019/05/15/packet-capture/wireshark3.jpg)

### TCPåŒ…å†…å®¹
![wireshark](2019/05/15/packet-capture/wireshark4.jpg)

### TCPå»ºç«‹è¿žæŽ¥ï¼ˆä¸‰æ¬¡æ¡æ‰‹ðŸ¤ï¼‰
![wireshark](2019/05/15/packet-capture/tcp1.jpg)
æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™æ¬¡TCPè¿žæŽ¥çš„å®Œæ•´è¿‡ç¨‹ï¼Œè¿žæŽ¥å®ŒæˆåŽå»ºç«‹TLSéš§é“è¿žæŽ¥ã€‚
æ­¤ä¾‹å­ä¸­30.38.36.123ä¸ºå®¢æˆ·ç«¯ï¼Œ52.231.18.241ä¸ºæœåŠ¡ç«¯ã€‚

![wireshark](2019/05/15/packet-capture/tcp2.jpg)
å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘å‡ºè¯·æ±‚è¿žæŽ¥çš„æŠ¥æ–‡ï¼Œå…¶ä¸­åŒæ­¥ä½SYNç½®ä¸º1ï¼Œå¹¶é€‰æ‹©äº†åºå·seqä¸ºxï¼ŒTCPè§„å®šSYNæŠ¥æ–‡æ®µï¼ˆå³SYNä¸º1çš„æŠ¥æ–‡ï¼‰ä¸èƒ½æºå¸¦æ•°æ®ï¼ˆå¯ä»¥çœ‹åˆ°LEN=0ï¼‰ï¼Œå¹¶ä¸”éœ€è¦æ¶ˆè€—ä¸€ä¸ªåºå·,æ­¤æ—¶å®¢æˆ·ç«¯è¿›å…¥SYN-SENTåŒæ­¥å·²å‘é€çŠ¶æ€ã€‚

![wireshark](2019/05/15/packet-capture/tcp3.jpg)
æœåŠ¡ç«¯åœ¨æ”¶åˆ°è¯·æ±‚æŠ¥æ–‡æ®µåŽå¦‚æžœåŒæ„è¿žæŽ¥ï¼Œåˆ™å‘å®¢æˆ·ç«¯å‘é€ç¡®è®¤ã€‚åœ¨ç¡®è®¤æŠ¥æ–‡æ®µä¸­å°†SYNã€ACKéƒ½ç½®ä¸º1ï¼Œç¡®è®¤å·Ackä¸ºx+1ï¼ŒåŒæ—¶ä¹Ÿä¸ºè‡ªå·±é€‰æ‹©ä¸€ä¸ªåºå·yï¼ˆå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„åºå·ä¸ç›¸åŒï¼‰ï¼Œæ­¤æŠ¥æ–‡æ®µä¹Ÿä¸æºå¸¦æ•°æ®ä¸”ä¹Ÿéœ€è¦æ¶ˆè€—ä¸€ä¸ªåºå·ã€‚æ­¤æ—¶æœåŠ¡å™¨è¿›å…¥SYN-RCVDåŒæ­¥æ”¶åˆ°çŠ¶æ€ã€‚

![wireshark](2019/05/15/packet-capture/tcp4.jpg)
å®¢æˆ·ç«¯åœ¨æ”¶åˆ°æœåŠ¡ç«¯çš„ç¡®è®¤åŽï¼Œè¿˜è¦å‘æœåŠ¡ç«¯å†æ¬¡å‘å‡ºç¡®è®¤ï¼Œå°†ç¡®è®¤ACKç½®ä¸º1ï¼Œç¡®è®¤å·Ackä¸ºy+1ï¼ŒåŒæ—¶å°†è‡ªå·±çš„åºå·seqç½®ä¸ºx+1ã€‚æ­¤æ—¶å®¢æˆ·ç«¯è¿›å…¥ESTABLISHEDå·²å»ºç«‹è¿žæŽ¥çŠ¶æ€ã€‚
æœåŠ¡ç«¯åœ¨æ”¶åˆ°ç¡®è®¤åŽä¹Ÿè¿›å…¥ESTABLISHEDçŠ¶æ€ã€‚

**åºå·seq** ï¼š æœ¬æ®µæŠ¥æ–‡ä¸­æ‰€å‘é€çš„æ•°æ®çš„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„åºå·ï¼Œä¾‹å¦‚ï¼šæœ¬æ®µæŠ¥æ–‡çš„åºå·ä¸º0ï¼Œæœ¬æ®µæŠ¥æ–‡é•¿åº¦100å­—èŠ‚ï¼Œä¸‹æ®µæŠ¥æ–‡çš„seqå°±ä¸º101ã€‚
**ç¡®è®¤å·Ack** ï¼š æœŸæœ›æ”¶åˆ°å¯¹æ–¹ä¸‹ä¸€æŠ¥æ–‡æ®µçš„ç¬¬ä¸€ä¸ªæ•°æ®å­—èŠ‚çš„åºå·ã€‚ä»…åœ¨æŽ§åˆ¶ä½ä¸­ç¡®è®¤ACKä¸º1æ—¶ç¡®è®¤å·æ‰æœ‰æ•ˆã€‚
**ç¡®è®¤ACK** ï¼š åœ¨è¿žæŽ¥å»ºç«‹åŽæ‰€æœ‰ä¼ é€çš„æŠ¥æ–‡æ®µéƒ½å¿…é¡»å°†ACKç½®ä¸º1ã€‚
**åŒæ­¥SYN** ï¼š åœ¨å»ºç«‹è¿žæŽ¥æ—¶ç”¨æ¥åŒæ­¥åºå·ã€‚TCPè§„å®šSYNæŠ¥æ–‡æ®µä¸å¾—æºå¸¦æ•°æ®ã€‚

### è¿‡æ»¤è¡¨è¾¾å¼
ä½¿ç”¨æ­£ç¡®çš„è¡¨è¾¾å¼å¯ä»¥å¿«é€Ÿçš„ä»ŽèŒ«èŒ«æ•°æ®ä¸­æ‰¾åˆ°ä½ æƒ³è¦çš„é‚£ä¸€å †ã€‚
- é€»è¾‘è¿ç®—ç¬¦ ï¼š andã€or
- http ï¼šåªçœ‹httpåè®®æˆ–å…¶å®ƒåè®®å
- ip.src == 127.0.0.1 ï¼š æºIPåœ°å€ä¸º127.0.0.1çš„å°åŒ…
- ip.dst == 0.0.0.0 ï¼š ç›®æ ‡åœ°å€ä¸º0.0.0.0çš„å°åŒ…
- tcp.port == 80 ï¼šç«¯å£ä¸º80çš„
- tcp.srcport == 443 ï¼šæºç«¯å£ä¸º443çš„
- http.request.method == "GET" ï¼šåªæ˜¾ç¤ºGETæ–¹æ³•çš„è¯·æ±‚ã€‚


> åˆ†äº«ä¸¤ç¯‡æ–‡ç« ï¼Œå¦‚æžœæƒ³æ·±å…¥å­¦ä¹ Wiresharkå¯ä»¥çœ‹çœ‹
> http://www.cnblogs.com/TankXiao/archive/2012/10/10/2711777.html
> https://www.cnblogs.com/dragonir/p/6219541.html